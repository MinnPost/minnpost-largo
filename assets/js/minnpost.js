'use strict';

(function ($) {

	function mp_analytics_tracking_event(type, category, action, label, value) {
		if (typeof ga !== 'undefined') {
			if (typeof value === 'undefined') {
				ga('send', type, category, action, label);
			} else {
				ga('send', type, category, action, label, value);
			}
		} else {
			return;
		}
	}

	function trackShare(text, position) {

		// if a not logged in user tries to email, don't count that as a share
		if (!$('body ').hasClass('logged-in') && 'Email' === text) {
			return;
		}

		// track as an event, and as social if it is twitter or fb
		mp_analytics_tracking_event('event', 'Share - ' + position, text, location.pathname);
		if ('undefined' !== typeof ga) {
			if ('Facebook' === text || 'Twitter' === text) {
				if (text == 'Facebook') {
					ga('send', 'social', text, 'Share', location.pathname);
				} else {
					ga('send', 'social', text, 'Tweet', location.pathname);
				}
			}
		} else {
			return;
		}
	}

	$('.m-entry-share-top a').click(function (e) {
		var text = $(this).text().trim();
		var position = 'top';
		trackShare(text, position);
	});

	$('.m-entry-share-bottom a').click(function (e) {
		var text = $(this).text().trim();
		var position = 'bottom';
		trackShare(text, position);
	});

	$('#navigation-featured a').click(function (e) {
		mp_analytics_tracking_event('event', 'Featured Bar Link', 'Click', this.href);
	});
	$('a.glean-sidebar').click(function (e) {
		mp_analytics_tracking_event('event', 'Sidebar Support Link', 'Click', this.href);
	});

	$('a', $('.o-site-sidebar')).click(function (e) {
		var widget_title = $(this).closest('.m-widget').find('h3').text();
		var sidebar_section_title = '';
		if (widget_title === '') {
			//sidebar_section_title = $(this).closest('.node-type-spill').find('.node-title a').text();
		} else {
			sidebar_section_title = widget_title;
		}
		mp_analytics_tracking_event('event', 'Sidebar Link', 'Click', sidebar_section_title);
	});

	$(document).ready(function (e) {

		if ('undefined' !== typeof PUM) {
			var current_popup = PUM.getPopup($('.pum'));
			var settings = PUM.getSettings($('.pum'));
			var popup_id = settings.id;
			$(document).on('pumAfterOpen', function () {
				mp_analytics_tracking_event('event', 'Popup', 'Show', popup_id, { 'nonInteraction': 1 });
			});
			$(document).on('pumAfterClose', function () {
				var close_trigger = $.fn.popmake.last_close_trigger;
				if ('undefined' !== typeof close_trigger) {
					mp_analytics_tracking_event('event', 'Popup', close_trigger, popup_id, { 'nonInteraction': 1 });
				}
			});
			$('.message-close').click(function (e) {
				// user clicks link with close class
				var close_trigger = 'Close Button';
				mp_analytics_tracking_event('event', 'Popup', close_trigger, popup_id, { 'nonInteraction': 1 });
			});
			$('.message-login').click(function (e) {
				// user clicks link with login class
				var url = $(this).attr('href');
				mp_analytics_tracking_event('event', 'Popup', 'Login Link', url);
			});
			$('.pum-content a:not( .message-close, .pum-close, .message-login )').click(function (e) {
				// user clicks something that is not close text or close icon
				mp_analytics_tracking_event('event', 'Popup', 'Click', popup_id);
			});
		}

		if ('undefined' !== typeof minnpost_membership_data && '' !== minnpost_membership_data.url_access_level) {
			var type = 'event';
			var category = 'Member Content';
			var label = location.pathname; // i think we could possibly put some grouping here, but we don't necessarily have access to one and maybe it's not worthwhile yet
			var action = 'Blocked';
			if (true === minnpost_membership_data.current_user.can_access) {
				action = 'Shown';
			}
			mp_analytics_tracking_event(type, category, action, label);
		}
	});
})(jQuery);
'use strict';

function gtag_report_conversion(url) {
	var callback = function callback() {
		if (typeof url != 'undefined') {
			window.location = url;
		}
	};
	gtag('event', 'conversion', {
		'send_to': 'AW-976620175/jqCyCL7atXkQj5XY0QM',
		'event_callback': callback
	});
	return false;
}

jQuery(document).ready(function ($) {
	"use strict";

	if ($('.m-form-newsletter-shortcode').length > 0) {
		$('.m-form-newsletter-shortcode fieldset').before('<div class="m-hold-message"></div>');
		$('.m-form-newsletter-shortcode form').submit(function (event) {
			var that = this;
			event.preventDefault(); // Prevent the default form submit.
			var button = $('button', this);
			button.prop('disabled', true);
			button.text('Processing');
			// serialize the form data
			var ajax_form_data = $(this).serialize();
			//add our own ajax check as X-Requested-With is not always reliable
			ajax_form_data = ajax_form_data + '&ajaxrequest=true&subscribe';
			$.ajax({
				url: params.ajaxurl, // domain/wp-admin/admin-ajax.php
				type: 'post',
				dataType: 'json',
				data: ajax_form_data
			}).done(function (response) {
				// response from the PHP action
				var message = '';
				if (response.success === true) {
					$('fieldset', that).hide();
					button.text('Thanks');
					var analytics_action = 'Signup';
					switch (response.data.user_status) {
						case 'existing':
							analytics_action = 'Update';
							message = 'Thanks for updating your email preferences. They will go into effect immediately.';
							break;
						case 'new':
							analytics_action = 'Signup';
							message = 'We have added you to the MinnPost mailing list.';
							break;
						case 'pending':
							analytics_action = 'Signup';
							message = 'We have added you to the MinnPost mailing list. You will need to click the confirmation link in the email we sent to begin receiving messages.';
							break;
					}
					if ('function' === typeof mp_analytics_tracking_event) {
						mp_analytics_tracking_event('event', 'Newsletter', analytics_action, location.pathname);
						gtag_report_conversion(location.pathname);
					}
				} else {
					button.prop('disabled', false);
					button.text('Subscribe');
					if ('function' === typeof mp_analytics_tracking_event) {
						mp_analytics_tracking_event('event', 'Newsletter', 'Fail', location.pathname);
					}
				}
				$('.m-hold-message').html('<div class="m-form-message m-form-message-info">' + message + '</div>');
			}).fail(function (response) {
				$('.m-hold-message').html('<div class="m-form-message m-form-message-info">An error has occured. Please try again.</div>');
				button.prop('disabled', false);
				button.text('Subscribe');
				if ('function' === typeof mp_analytics_tracking_event) {
					mp_analytics_tracking_event('event', 'Newsletter', 'Fail', location.pathname);
				}
			}).always(function () {
				event.target.reset();
			});
		});
	}
});
'use strict';

/**
 * File navigation.js.
 *
 * Handles toggling the navigation menu for small screens and enables TAB key
 * navigation support for dropdown menus.
 */
(function () {
	var container, button, menu, links, i, len;

	container = document.getElementById('navigation-primary');
	if (!container) {
		return;
	}

	button = container.getElementsByTagName('button')[0];
	if ('undefined' === typeof button) {
		return;
	}

	menu = container.getElementsByTagName('ul')[0];

	// Hide menu toggle button if menu is empty and return early.
	if ('undefined' === typeof menu) {
		button.style.display = 'none';
		return;
	}

	menu.setAttribute('aria-expanded', 'false');
	if (-1 === menu.className.indexOf('menu')) {
		menu.className += ' menu';
	}

	button.onclick = function () {
		if (-1 !== container.className.indexOf('toggled')) {
			container.className = container.className.replace(' toggled', '');
			button.setAttribute('aria-expanded', 'false');
			menu.setAttribute('aria-expanded', 'false');
		} else {
			container.className += ' toggled';
			button.setAttribute('aria-expanded', 'true');
			menu.setAttribute('aria-expanded', 'true');
		}
	};

	// Get all the link elements within the menu.
	links = menu.getElementsByTagName('a');

	// Each time a menu link is focused or blurred, toggle focus.
	for (i = 0, len = links.length; i < len; i++) {
		links[i].addEventListener('focus', toggleFocus, true);
		links[i].addEventListener('blur', toggleFocus, true);
	}

	/**
  * Sets or removes .focus class on an element.
  */
	function toggleFocus() {
		var self = this;

		// Move up through the ancestors of the current link until we hit .nav-menu.
		while (-1 === self.className.indexOf('menu')) {

			// On li elements toggle the class .focus.
			if ('li' === self.tagName.toLowerCase()) {
				if (-1 !== self.className.indexOf('focus')) {
					self.className = self.className.replace(' focus', '');
				} else {
					self.className += ' focus';
				}
			}

			self = self.parentElement;
		}
	}

	/**
  * Toggles `focus` class to allow submenu access on tablets.
  */
	(function (container) {
		var touchStartFn,
		    i,
		    parentLink = container.querySelectorAll('.menu-item-has-children > a, .page_item_has_children > a');

		if ('ontouchstart' in window) {
			touchStartFn = function touchStartFn(e) {
				var menuItem = this.parentNode,
				    i;

				if (!menuItem.classList.contains('focus')) {
					e.preventDefault();
					for (i = 0; i < menuItem.parentNode.children.length; ++i) {
						if (menuItem === menuItem.parentNode.children[i]) {
							continue;
						}
						menuItem.parentNode.children[i].classList.remove('focus');
					}
					menuItem.classList.add('focus');
				} else {
					menuItem.classList.remove('focus');
				}
			};

			for (i = 0; i < parentLink.length; ++i) {
				parentLink[i].addEventListener('touchstart', touchStartFn, false);
			}
		}
	})(container);
})();

// user account navigation can be a dropdown
jQuery(document).ready(function ($) {
	// hide menu
	if ($('#user-account-access ul').length > 0) {
		$('#user-account-access > li > a').on('click', function (event) {
			$('#user-account-access ul').toggleClass('visible');
			event.preventDefault();
		});
	}
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFuYWx5dGljcy5qcyIsImZvcm1zLmpzIiwibmF2aWdhdGlvbi5qcyJdLCJuYW1lcyI6WyIkIiwibXBfYW5hbHl0aWNzX3RyYWNraW5nX2V2ZW50IiwidHlwZSIsImNhdGVnb3J5IiwiYWN0aW9uIiwibGFiZWwiLCJ2YWx1ZSIsImdhIiwidHJhY2tTaGFyZSIsInRleHQiLCJwb3NpdGlvbiIsImhhc0NsYXNzIiwibG9jYXRpb24iLCJwYXRobmFtZSIsImNsaWNrIiwiZSIsInRyaW0iLCJocmVmIiwid2lkZ2V0X3RpdGxlIiwiY2xvc2VzdCIsImZpbmQiLCJzaWRlYmFyX3NlY3Rpb25fdGl0bGUiLCJkb2N1bWVudCIsInJlYWR5IiwiUFVNIiwiY3VycmVudF9wb3B1cCIsImdldFBvcHVwIiwic2V0dGluZ3MiLCJnZXRTZXR0aW5ncyIsInBvcHVwX2lkIiwiaWQiLCJvbiIsImNsb3NlX3RyaWdnZXIiLCJmbiIsInBvcG1ha2UiLCJsYXN0X2Nsb3NlX3RyaWdnZXIiLCJ1cmwiLCJhdHRyIiwibWlubnBvc3RfbWVtYmVyc2hpcF9kYXRhIiwidXJsX2FjY2Vzc19sZXZlbCIsImN1cnJlbnRfdXNlciIsImNhbl9hY2Nlc3MiLCJqUXVlcnkiLCJndGFnX3JlcG9ydF9jb252ZXJzaW9uIiwiY2FsbGJhY2siLCJ3aW5kb3ciLCJndGFnIiwibGVuZ3RoIiwiYmVmb3JlIiwic3VibWl0IiwiZXZlbnQiLCJ0aGF0IiwicHJldmVudERlZmF1bHQiLCJidXR0b24iLCJwcm9wIiwiYWpheF9mb3JtX2RhdGEiLCJzZXJpYWxpemUiLCJhamF4IiwicGFyYW1zIiwiYWpheHVybCIsImRhdGFUeXBlIiwiZGF0YSIsImRvbmUiLCJyZXNwb25zZSIsIm1lc3NhZ2UiLCJzdWNjZXNzIiwiaGlkZSIsImFuYWx5dGljc19hY3Rpb24iLCJ1c2VyX3N0YXR1cyIsImh0bWwiLCJmYWlsIiwiYWx3YXlzIiwidGFyZ2V0IiwicmVzZXQiLCJjb250YWluZXIiLCJtZW51IiwibGlua3MiLCJpIiwibGVuIiwiZ2V0RWxlbWVudEJ5SWQiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInN0eWxlIiwiZGlzcGxheSIsInNldEF0dHJpYnV0ZSIsImNsYXNzTmFtZSIsImluZGV4T2YiLCJvbmNsaWNrIiwicmVwbGFjZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJ0b2dnbGVGb2N1cyIsInNlbGYiLCJ0YWdOYW1lIiwidG9Mb3dlckNhc2UiLCJwYXJlbnRFbGVtZW50IiwidG91Y2hTdGFydEZuIiwicGFyZW50TGluayIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJtZW51SXRlbSIsInBhcmVudE5vZGUiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsImNoaWxkcmVuIiwicmVtb3ZlIiwiYWRkIiwidG9nZ2xlQ2xhc3MiXSwibWFwcGluZ3MiOiI7O0FBQUEsQ0FBRSxVQUFVQSxDQUFWLEVBQWM7O0FBRWYsVUFBU0MsMkJBQVQsQ0FBc0NDLElBQXRDLEVBQTRDQyxRQUE1QyxFQUFzREMsTUFBdEQsRUFBOERDLEtBQTlELEVBQXFFQyxLQUFyRSxFQUE2RTtBQUM1RSxNQUFLLE9BQU9DLEVBQVAsS0FBYyxXQUFuQixFQUFpQztBQUNoQyxPQUFLLE9BQU9ELEtBQVAsS0FBaUIsV0FBdEIsRUFBb0M7QUFDbkNDLE9BQUksTUFBSixFQUFZTCxJQUFaLEVBQWtCQyxRQUFsQixFQUE0QkMsTUFBNUIsRUFBb0NDLEtBQXBDO0FBQ0EsSUFGRCxNQUVPO0FBQ05FLE9BQUksTUFBSixFQUFZTCxJQUFaLEVBQWtCQyxRQUFsQixFQUE0QkMsTUFBNUIsRUFBb0NDLEtBQXBDLEVBQTJDQyxLQUEzQztBQUNBO0FBQ0QsR0FORCxNQU1PO0FBQ047QUFDQTtBQUNEOztBQUVELFVBQVNFLFVBQVQsQ0FBcUJDLElBQXJCLEVBQTJCQyxRQUEzQixFQUFzQzs7QUFFckM7QUFDQSxNQUFLLENBQUVWLEVBQUcsT0FBSCxFQUFZVyxRQUFaLENBQXNCLFdBQXRCLENBQUYsSUFBd0MsWUFBWUYsSUFBekQsRUFBZ0U7QUFDL0Q7QUFDQTs7QUFFRDtBQUNBUiw4QkFB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QUFhQSxJQUFJa0IsV0FBV2hELE1BQTVCLEVBQW9DLEVBQUU4QixDQUF0QyxFQUEwQztBQUN6Q2tCLGVBQVdsQixDQUFYLEVBQWNXLGdCQUFkLENBQWdDLFlBQWhDLEVBQThDTSxZQUE5QyxFQUE0RCxLQUE1RDtBQUNBO0FBQ0Q7QUFDRCxFQTFCQyxFQTBCQ3BCLFNBMUJELENBQUY7QUEyQkEsQ0FuR0Q7O0FBcUdBO0FBQ0FoQyxPQUFRcEIsUUFBUixFQUFtQkMsS0FBbkIsQ0FBMEIsVUFBVXZCLENBQVYsRUFBYztBQUN2QztBQUNBLEtBQUlBLEVBQUUseUJBQUYsRUFBNkIrQyxNQUE3QixHQUFzQyxDQUExQyxFQUE4QztBQUM3Qy9DLElBQUUsK0JBQUYsRUFBbUMrQixFQUFuQyxDQUF1QyxPQUF2QyxFQUFnRCxVQUFTbUIsS0FBVCxFQUFnQjtBQUMvRGxELEtBQUUseUJBQUYsRUFBNkJ3RyxXQUE3QixDQUEwQyxTQUExQztBQUNBdEQsU0FBTUUsY0FBTjtBQUNBLEdBSEQ7QUFJQTtBQUVELENBVEQiLCJmaWxlIjoibWlubnBvc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoIGZ1bmN0aW9uKCAkICkge1xuXG5cdGZ1bmN0aW9uIG1wX2FuYWx5dGljc190cmFja2luZ19ldmVudCggdHlwZSwgY2F0ZWdvcnksIGFjdGlvbiwgbGFiZWwsIHZhbHVlICkge1xuXHRcdGlmICggdHlwZW9mIGdhICE9PSAndW5kZWZpbmVkJyApIHtcblx0XHRcdGlmICggdHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJyApIHtcblx0XHRcdFx0Z2EoICdzZW5kJywgdHlwZSwgY2F0ZWdvcnksIGFjdGlvbiwgbGFiZWwgKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdhKCAnc2VuZCcsIHR5cGUsIGNhdGVnb3J5LCBhY3Rpb24sIGxhYmVsLCB2YWx1ZSApO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHR9XG5cblx0ZnVuY3Rpb24gdHJhY2tTaGFyZSggdGV4dCwgcG9zaXRpb24gKSB7XG5cblx0XHQvLyBpZiBhIG5vdCBsb2dnZWQgaW4gdXNlciB0cmllcyB0byBlbWFpbCwgZG9uJ3QgY291bnQgdGhhdCBhcyBhIHNoYXJlXG5cdFx0aWYgKCAhICQoICdib2R5ICcpLmhhc0NsYXNzKCAnbG9nZ2VkLWluJykgJiYgJ0VtYWlsJyA9PT0gdGV4dCApIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHQvLyB0cmFjayBhcyBhbiBldmVudCwgYW5kIGFzIHNvY2lhbCBpZiBpdCBpcyB0d2l0dGVyIG9yIGZiXG5cdFx0bXBfYW5hbHl0aWNzX3RyYWNraW5nX2V2ZW50KCAnZXZlbnQnLCAnU2hhcmUgLSAnICsgcG9zaXRpb24sIHRleHQsIGxvY2F0aW9uLnBhdGhuYW1lICk7XG5cdFx0aWYgKCAndW5kZWZpbmVkJyAhPT0gdHlwZW9mIGdhICkge1xuXHRcdFx0aWYgKCAnRmFjZWJvb2snID09PSB0ZXh0IHx8ICdUd2l0dGVyJyA9PT0gdGV4dCApIHtcblx0XHRcdFx0aWYgKCB0ZXh0ID09ICdGYWNlYm9vaycgKSB7XG5cdFx0XHRcdFx0Z2EoICdzZW5kJywgJ3NvY2lhbCcsIHRleHQsICdTaGFyZScsIGxvY2F0aW9uLnBhdGhuYW1lICk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Z2EoICdzZW5kJywgJ3NvY2lhbCcsIHRleHQsICdUd2VldCcsIGxvY2F0aW9uLnBhdGhuYW1lICk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0fVxuXG5cdCQgKCAnLm0tZW50cnktc2hhcmUtdG9wIGEnICkuY2xpY2soIGZ1bmN0aW9uKCBlICkge1xuXHRcdHZhciB0ZXh0ID0gJCggdGhpcyApLnRleHQoKS50cmltKCk7XG5cdFx0dmFyIHBvc2l0aW9uID0gJ3RvcCc7XG5cdFx0dHJhY2tTaGFyZSggdGV4dCwgcG9zaXRpb24gKTtcblx0fSk7XG5cblx0JCAoICcubS1lbnRyeS1zaGFyZS1ib3R0b20gYScgKS5jbGljayggZnVuY3Rpb24oIGUgKSB7XG5cdFx0dmFyIHRleHQgPSAkKCB0aGlzICkudGV4dCgpLnRyaW0oKTtcblx0XHR2YXIgcG9zaXRpb24gPSAnYm90dG9tJztcblx0XHR0cmFja1NoYXJlKCB0ZXh0LCBwb3NpdGlvbiApO1xuXHR9KTtcblxuXHQkKCAnI25hdmlnYXRpb24tZmVhdHVyZWQgYScgKS5jbGljayggZnVuY3Rpb24oIGUgKSB7XG5cdFx0bXBfYW5hbHl0aWNzX3RyYWNraW5nX2V2ZW50KCAnZXZlbnQnLCAnRmVhdHVyZWQgQmFyIExpbmsnLCAnQ2xpY2snLCB0aGlzLmhyZWYgKTtcblx0fSk7XG5cdCQoICdhLmdsZWFuLXNpZGViYXInICkuY2xpY2soIGZ1bmN0aW9uKCBlICkge1xuXHRcdG1wX2FuYWx5dGljc190cmFja2luZ19ldmVudCggJ2V2ZW50JywgJ1NpZGViYXIgU3VwcG9ydCBMaW5rJywgJ0NsaWNrJywgdGhpcy5ocmVmICk7XG5cdH0pO1xuXG5cdCQoICdhJywgJCggJy5vLXNpdGUtc2lkZWJhcicgKSApLmNsaWNrKCBmdW5jdGlvbiggZSApIHtcblx0XHR2YXIgd2lkZ2V0X3RpdGxlID0gJCh0aGlzKS5jbG9zZXN0KCcubS13aWRnZXQnKS5maW5kKCdoMycpLnRleHQoKTtcblx0XHR2YXIgc2lkZWJhcl9zZWN0aW9uX3RpdGxlID0gJyc7XG5cdFx0aWYgKHdpZGdldF90aXRsZSA9PT0gJycpIHtcblx0XHRcdC8vc2lkZWJhcl9zZWN0aW9uX3RpdGxlID0gJCh0aGlzKS5jbG9zZXN0KCcubm9kZS10eXBlLXNwaWxsJykuZmluZCgnLm5vZGUtdGl0bGUgYScpLnRleHQoKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0c2lkZWJhcl9zZWN0aW9uX3RpdGxlID0gd2lkZ2V0X3RpdGxlO1xuXHRcdH1cblx0XHRtcF9hbmFseXRpY3NfdHJhY2tpbmdfZXZlbnQoJ2V2ZW50JywgJ1NpZGViYXIgTGluaycsICdDbGljaycsIHNpZGViYXJfc2VjdGlvbl90aXRsZSk7XG5cdH0pO1xuXG5cdCQoIGRvY3VtZW50ICkucmVhZHkoIGZ1bmN0aW9uICggZSApIHtcblxuXHRcdGlmICggJ3VuZGVmaW5lZCcgIT09IHR5cGVvZiBQVU0gKSB7XG5cdFx0XHR2YXIgY3VycmVudF9wb3B1cCA9IFBVTS5nZXRQb3B1cCggJCggJy5wdW0nICkgKTtcblx0XHRcdHZhciBzZXR0aW5ncyA9IFBVTS5nZXRTZXR0aW5ncyggJCggJy5wdW0nICkgKTtcblx0XHRcdHZhciBwb3B1cF9pZCA9IHNldHRpbmdzLmlkO1xuXHRcdFx0JCggZG9jdW1lbnQgKS5vbigncHVtQWZ0ZXJPcGVuJywgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRtcF9hbmFseXRpY3NfdHJhY2tpbmdfZXZlbnQoICdldmVudCcsICdQb3B1cCcsICdTaG93JywgcG9wdXBfaWQsIHsgJ25vbkludGVyYWN0aW9uJzogMSB9ICk7XG5cdFx0XHR9KTtcblx0XHRcdCQoIGRvY3VtZW50ICkub24oJ3B1bUFmdGVyQ2xvc2UnLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdHZhciBjbG9zZV90cmlnZ2VyID0gJC5mbi5wb3BtYWtlLmxhc3RfY2xvc2VfdHJpZ2dlcjtcblx0XHRcdFx0aWYgKCAndW5kZWZpbmVkJyAhPT0gdHlwZW9mIGNsb3NlX3RyaWdnZXIgKSB7XG5cdFx0XHRcdFx0bXBfYW5hbHl0aWNzX3RyYWNraW5nX2V2ZW50KCAnZXZlbnQnLCAnUG9wdXAnLCBjbG9zZV90cmlnZ2VyLCBwb3B1cF9pZCwgeyAnbm9uSW50ZXJhY3Rpb24nOiAxIH0gKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHQkKCAnLm1lc3NhZ2UtY2xvc2UnICkuY2xpY2soZnVuY3Rpb24oIGUgKSB7IC8vIHVzZXIgY2xpY2tzIGxpbmsgd2l0aCBjbG9zZSBjbGFzc1xuXHRcdFx0XHR2YXIgY2xvc2VfdHJpZ2dlciA9ICdDbG9zZSBCdXR0b24nO1xuXHRcdFx0XHRtcF9hbmFseXRpY3NfdHJhY2tpbmdfZXZlbnQoICdldmVudCcsICdQb3B1cCcsIGNsb3NlX3RyaWdnZXIsIHBvcHVwX2lkLCB7ICdub25JbnRlcmFjdGlvbic6IDEgfSApO1xuXHRcdFx0fSk7XG5cdFx0XHQkKCAnLm1lc3NhZ2UtbG9naW4nICkuY2xpY2soZnVuY3Rpb24oIGUgKSB7IC8vIHVzZXIgY2xpY2tzIGxpbmsgd2l0aCBsb2dpbiBjbGFzc1xuXHRcdFx0XHR2YXIgdXJsID0gJCh0aGlzKS5hdHRyKCdocmVmJyk7XG5cdFx0XHRcdG1wX2FuYWx5dGljc190cmFja2luZ19ldmVudCggJ2V2ZW50JywgJ1BvcHVwJywgJ0xvZ2luIExpbmsnLCB1cmwgKTtcblx0XHRcdH0pO1xuXHRcdFx0JCggJy5wdW0tY29udGVudCBhOm5vdCggLm1lc3NhZ2UtY2xvc2UsIC5wdW0tY2xvc2UsIC5tZXNzYWdlLWxvZ2luICknICkuY2xpY2soIGZ1bmN0aW9uKCBlICkgeyAvLyB1c2VyIGNsaWNrcyBzb21ldGhpbmcgdGhhdCBpcyBub3QgY2xvc2UgdGV4dCBvciBjbG9zZSBpY29uXG5cdFx0XHRcdG1wX2FuYWx5dGljc190cmFja2luZ19ldmVudCggJ2V2ZW50JywgJ1BvcHVwJywgJ0NsaWNrJywgcG9wdXBfaWQgKTtcbiAgICAgICAgICAgIH0pO1xuXHRcdH1cblxuXHRcdGlmICggJ3VuZGVmaW5lZCcgIT09IHR5cGVvZiBtaW5ucG9zdF9tZW1iZXJzaGlwX2RhdGEgJiYgJycgIT09IG1pbm5wb3N0X21lbWJlcnNoaXBfZGF0YS51cmxfYWNjZXNzX2xldmVsICkge1xuXHRcdFx0dmFyIHR5cGUgPSAnZXZlbnQnO1xuXHRcdFx0dmFyIGNhdGVnb3J5ID0gJ01lbWJlciBDb250ZW50Jztcblx0XHRcdHZhciBsYWJlbCA9IGxvY2F0aW9uLnBhdGhuYW1lOyAvLyBpIHRoaW5rIHdlIGNvdWxkIHBvc3NpYmx5IHB1dCBzb21lIGdyb3VwaW5nIGhlcmUsIGJ1dCB3ZSBkb24ndCBuZWNlc3NhcmlseSBoYXZlIGFjY2VzcyB0byBvbmUgYW5kIG1heWJlIGl0J3Mgbm90IHdvcnRod2hpbGUgeWV0XG5cdFx0XHR2YXIgYWN0aW9uID0gJ0Jsb2NrZWQnO1xuXHRcdFx0aWYgKCB0cnVlID09PSBtaW5ucG9zdF9tZW1iZXJzaGlwX2RhdGEuY3VycmVudF91c2VyLmNhbl9hY2Nlc3MgKSB7XG5cdFx0XHRcdGFjdGlvbiA9ICdTaG93bic7XG5cdFx0XHR9XG5cdFx0XHRtcF9hbmFseXRpY3NfdHJhY2tpbmdfZXZlbnQoIHR5cGUsIGNhdGVnb3J5LCBhY3Rpb24sIGxhYmVsICk7XG5cdFx0fVxuXHR9KTtcblxufSApKCBqUXVlcnkgKTsiLCJmdW5jdGlvbiBndGFnX3JlcG9ydF9jb252ZXJzaW9uKHVybCkge1xuXHR2YXIgY2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7XG5cdCAgaWYgKHR5cGVvZih1cmwpICE9ICd1bmRlZmluZWQnKSB7XG5cdCAgICB3aW5kb3cubG9jYXRpb24gPSB1cmw7XG5cdCAgfVxuXHR9O1xuXHRndGFnKCdldmVudCcsICdjb252ZXJzaW9uJywge1xuXHQgICdzZW5kX3RvJzogJ0FXLTk3NjYyMDE3NS9qcUN5Q0w3YXRYa1FqNVhZMFFNJyxcblx0ICAnZXZlbnRfY2FsbGJhY2snOiBjYWxsYmFja1xuXHR9KTtcblx0cmV0dXJuIGZhbHNlO1xufVxuXG5qUXVlcnkoIGRvY3VtZW50ICkucmVhZHkoIGZ1bmN0aW9uKCAkICkge1xuXHRcInVzZSBzdHJpY3RcIjtcblx0aWYgKCAkKCcubS1mb3JtLW5ld3NsZXR0ZXItc2hvcnRjb2RlJykubGVuZ3RoID4gMCApIHtcblx0XHQkKCcubS1mb3JtLW5ld3NsZXR0ZXItc2hvcnRjb2RlIGZpZWxkc2V0JykuYmVmb3JlKCc8ZGl2IGNsYXNzPVwibS1ob2xkLW1lc3NhZ2VcIj48L2Rpdj4nKTtcblx0XHQkKCcubS1mb3JtLW5ld3NsZXR0ZXItc2hvcnRjb2RlIGZvcm0nKS5zdWJtaXQoZnVuY3Rpb24oZXZlbnQpIHtcblx0XHRcdHZhciB0aGF0ID0gdGhpcztcblx0XHRcdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IC8vIFByZXZlbnQgdGhlIGRlZmF1bHQgZm9ybSBzdWJtaXQuXG5cdFx0XHR2YXIgYnV0dG9uID0gJCgnYnV0dG9uJywgdGhpcyk7XG5cdFx0XHRidXR0b24ucHJvcCgnZGlzYWJsZWQnLCB0cnVlKTtcblx0XHRcdGJ1dHRvbi50ZXh0KCdQcm9jZXNzaW5nJyk7XG5cdFx0XHQvLyBzZXJpYWxpemUgdGhlIGZvcm0gZGF0YVxuXHRcdFx0dmFyIGFqYXhfZm9ybV9kYXRhID0gJCh0aGlzKS5zZXJpYWxpemUoKTtcblx0XHRcdC8vYWRkIG91ciBvd24gYWpheCBjaGVjayBhcyBYLVJlcXVlc3RlZC1XaXRoIGlzIG5vdCBhbHdheXMgcmVsaWFibGVcblx0XHRcdGFqYXhfZm9ybV9kYXRhID0gYWpheF9mb3JtX2RhdGEgKyAnJmFqYXhyZXF1ZXN0PXRydWUmc3Vic2NyaWJlJztcblx0XHRcdCQuYWpheCh7XG5cdFx0XHRcdHVybDogcGFyYW1zLmFqYXh1cmwsIC8vIGRvbWFpbi93cC1hZG1pbi9hZG1pbi1hamF4LnBocFxuXHRcdFx0XHR0eXBlOiAncG9zdCcsXG5cdFx0XHRcdGRhdGFUeXBlIDogJ2pzb24nLFxuXHRcdFx0XHRkYXRhOiBhamF4X2Zvcm1fZGF0YVxuXHRcdFx0fSlcblx0XHRcdC5kb25lKGZ1bmN0aW9uKHJlc3BvbnNlKSB7IC8vIHJlc3BvbnNlIGZyb20gdGhlIFBIUCBhY3Rpb25cblx0XHRcdFx0dmFyIG1lc3NhZ2UgPSAnJztcblx0XHRcdFx0aWYgKCByZXNwb25zZS5zdWNjZXNzID09PSB0cnVlICkge1xuXHRcdFx0XHRcdCQoJ2ZpZWxkc2V0JywgdGhhdCkuaGlkZSgpO1xuXHRcdFx0XHRcdGJ1dHRvbi50ZXh0KCdUaGFua3MnKTtcblx0XHRcdFx0XHR2YXIgYW5hbHl0aWNzX2FjdGlvbiA9ICdTaWdudXAnO1xuXHRcdFx0XHRcdHN3aXRjaCAocmVzcG9uc2UuZGF0YS51c2VyX3N0YXR1cykge1xuXHRcdFx0XHRcdFx0Y2FzZSAnZXhpc3RpbmcnOlxuXHRcdFx0XHRcdFx0XHRhbmFseXRpY3NfYWN0aW9uID0gJ1VwZGF0ZSc7XG5cdFx0XHRcdFx0XHRcdG1lc3NhZ2UgPSAnVGhhbmtzIGZvciB1cGRhdGluZyB5b3VyIGVtYWlsIHByZWZlcmVuY2VzLiBUaGV5IHdpbGwgZ28gaW50byBlZmZlY3QgaW1tZWRpYXRlbHkuJztcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRjYXNlICduZXcnOlxuXHRcdFx0XHRcdFx0XHRhbmFseXRpY3NfYWN0aW9uID0gJ1NpZ251cCc7XG5cdFx0XHRcdFx0XHRcdG1lc3NhZ2UgPSAnV2UgaGF2ZSBhZGRlZCB5b3UgdG8gdGhlIE1pbm5Qb3N0IG1haWxpbmcgbGlzdC4nO1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdGNhc2UgJ3BlbmRpbmcnOlxuXHRcdFx0XHRcdFx0XHRhbmFseXRpY3NfYWN0aW9uID0gJ1NpZ251cCc7XG5cdFx0XHRcdFx0XHRcdG1lc3NhZ2UgPSAnV2UgaGF2ZSBhZGRlZCB5b3UgdG8gdGhlIE1pbm5Qb3N0IG1haWxpbmcgbGlzdC4gWW91IHdpbGwgbmVlZCB0byBjbGljayB0aGUgY29uZmlybWF0aW9uIGxpbmsgaW4gdGhlIGVtYWlsIHdlIHNlbnQgdG8gYmVnaW4gcmVjZWl2aW5nIG1lc3NhZ2VzLic7XG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAoICdmdW5jdGlvbicgPT09IHR5cGVvZiBtcF9hbmFseXRpY3NfdHJhY2tpbmdfZXZlbnQgKSB7XG5cdFx0XHRcdFx0XHRtcF9hbmFseXRpY3NfdHJhY2tpbmdfZXZlbnQoICdldmVudCcsICdOZXdzbGV0dGVyJywgYW5hbHl0aWNzX2FjdGlvbiwgbG9jYXRpb24ucGF0aG5hbWUgKTtcblx0XHRcdFx0XHRcdGd0YWdfcmVwb3J0X2NvbnZlcnNpb24oIGxvY2F0aW9uLnBhdGhuYW1lICk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGJ1dHRvbi5wcm9wKCdkaXNhYmxlZCcsIGZhbHNlKTtcblx0XHRcdFx0XHRidXR0b24udGV4dCgnU3Vic2NyaWJlJyk7XG5cdFx0XHRcdFx0aWYgKCAnZnVuY3Rpb24nID09PSB0eXBlb2YgbXBfYW5hbHl0aWNzX3RyYWNraW5nX2V2ZW50ICkge1xuXHRcdFx0XHRcdFx0bXBfYW5hbHl0aWNzX3RyYWNraW5nX2V2ZW50KCAnZXZlbnQnLCAnTmV3c2xldHRlcicsICdGYWlsJywgbG9jYXRpb24ucGF0aG5hbWUgKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdFx0JCgnLm0taG9sZC1tZXNzYWdlJykuaHRtbCgnPGRpdiBjbGFzcz1cIm0tZm9ybS1tZXNzYWdlIG0tZm9ybS1tZXNzYWdlLWluZm9cIj4nICsgbWVzc2FnZSArICc8L2Rpdj4nKTtcblx0XHRcdH0pXG5cdFx0XHQuZmFpbChmdW5jdGlvbihyZXNwb25zZSkge1xuXHRcdFx0XHQkKCcubS1ob2xkLW1lc3NhZ2UnKS5odG1sKCc8ZGl2IGNsYXNzPVwibS1mb3JtLW1lc3NhZ2UgbS1mb3JtLW1lc3NhZ2UtaW5mb1wiPkFuIGVycm9yIGhhcyBvY2N1cmVkLiBQbGVhc2UgdHJ5IGFnYWluLjwvZGl2PicpO1xuXHRcdFx0XHRidXR0b24ucHJvcCgnZGlzYWJsZWQnLCBmYWxzZSk7XG5cdFx0XHRcdGJ1dHRvbi50ZXh0KCdTdWJzY3JpYmUnKTtcblx0XHRcdFx0aWYgKCAnZnVuY3Rpb24nID09PSB0eXBlb2YgbXBfYW5hbHl0aWNzX3RyYWNraW5nX2V2ZW50ICkge1xuXHRcdFx0XHRcdG1wX2FuYWx5dGljc190cmFja2luZ19ldmVudCggJ2V2ZW50JywgJ05ld3NsZXR0ZXInLCAnRmFpbCcsIGxvY2F0aW9uLnBhdGhuYW1lICk7XG5cdFx0XHRcdH1cblx0XHRcdH0pXG5cdFx0XHQuYWx3YXlzKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRldmVudC50YXJnZXQucmVzZXQoKTtcblx0XHRcdH0pO1xuXHRcdH0pO1xuXHR9XG59KTsiLCIvKipcbiAqIEZpbGUgbmF2aWdhdGlvbi5qcy5cbiAqXG4gKiBIYW5kbGVzIHRvZ2dsaW5nIHRoZSBuYXZpZ2F0aW9uIG1lbnUgZm9yIHNtYWxsIHNjcmVlbnMgYW5kIGVuYWJsZXMgVEFCIGtleVxuICogbmF2aWdhdGlvbiBzdXBwb3J0IGZvciBkcm9wZG93biBtZW51cy5cbiAqL1xuKCBmdW5jdGlvbigpIHtcblx0dmFyIGNvbnRhaW5lciwgYnV0dG9uLCBtZW51LCBsaW5rcywgaSwgbGVuO1xuXG5cdGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCAnbmF2aWdhdGlvbi1wcmltYXJ5JyApO1xuXHRpZiAoICEgY29udGFpbmVyICkge1xuXHRcdHJldHVybjtcblx0fVxuXG5cdGJ1dHRvbiA9IGNvbnRhaW5lci5nZXRFbGVtZW50c0J5VGFnTmFtZSggJ2J1dHRvbicgKVswXTtcblx0aWYgKCAndW5kZWZpbmVkJyA9PT0gdHlwZW9mIGJ1dHRvbiApIHtcblx0XHRyZXR1cm47XG5cdH1cblxuXHRtZW51ID0gY29udGFpbmVyLmdldEVsZW1lbnRzQnlUYWdOYW1lKCAndWwnIClbMF07XG5cblx0Ly8gSGlkZSBtZW51IHRvZ2dsZSBidXR0b24gaWYgbWVudSBpcyBlbXB0eSBhbmQgcmV0dXJuIGVhcmx5LlxuXHRpZiAoICd1bmRlZmluZWQnID09PSB0eXBlb2YgbWVudSApIHtcblx0XHRidXR0b24uc3R5bGUuZGlzcGxheSA9ICdub25lJztcblx0XHRyZXR1cm47XG5cdH1cblxuXHRtZW51LnNldEF0dHJpYnV0ZSggJ2FyaWEtZXhwYW5kZWQnLCAnZmFsc2UnICk7XG5cdGlmICggLTEgPT09IG1lbnUuY2xhc3NOYW1lLmluZGV4T2YoICdtZW51JyApICkge1xuXHRcdG1lbnUuY2xhc3NOYW1lICs9ICcgbWVudSc7XG5cdH1cblxuXHRidXR0b24ub25jbGljayA9IGZ1bmN0aW9uKCkge1xuXHRcdGlmICggLTEgIT09IGNvbnRhaW5lci5jbGFzc05hbWUuaW5kZXhPZiggJ3RvZ2dsZWQnICkgKSB7XG5cdFx0XHRjb250YWluZXIuY2xhc3NOYW1lID0gY29udGFpbmVyLmNsYXNzTmFtZS5yZXBsYWNlKCAnIHRvZ2dsZWQnLCAnJyApO1xuXHRcdFx0YnV0dG9uLnNldEF0dHJpYnV0ZSggJ2FyaWEtZXhwYW5kZWQnLCAnZmFsc2UnICk7XG5cdFx0XHRtZW51LnNldEF0dHJpYnV0ZSggJ2FyaWEtZXhwYW5kZWQnLCAnZmFsc2UnICk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvbnRhaW5lci5jbGFzc05hbWUgKz0gJyB0b2dnbGVkJztcblx0XHRcdGJ1dHRvbi5zZXRBdHRyaWJ1dGUoICdhcmlhLWV4cGFuZGVkJywgJ3RydWUnICk7XG5cdFx0XHRtZW51LnNldEF0dHJpYnV0ZSggJ2FyaWEtZXhwYW5kZWQnLCAndHJ1ZScgKTtcblx0XHR9XG5cdH07XG5cblx0Ly8gR2V0IGFsbCB0aGUgbGluayBlbGVtZW50cyB3aXRoaW4gdGhlIG1lbnUuXG5cdGxpbmtzICAgID0gbWVudS5nZXRFbGVtZW50c0J5VGFnTmFtZSggJ2EnICk7XG5cblx0Ly8gRWFjaCB0aW1lIGEgbWVudSBsaW5rIGlzIGZvY3VzZWQgb3IgYmx1cnJlZCwgdG9nZ2xlIGZvY3VzLlxuXHRmb3IgKCBpID0gMCwgbGVuID0gbGlua3MubGVuZ3RoOyBpIDwgbGVuOyBpKysgKSB7XG5cdFx0bGlua3NbaV0uYWRkRXZlbnRMaXN0ZW5lciggJ2ZvY3VzJywgdG9nZ2xlRm9jdXMsIHRydWUgKTtcblx0XHRsaW5rc1tpXS5hZGRFdmVudExpc3RlbmVyKCAnYmx1cicsIHRvZ2dsZUZvY3VzLCB0cnVlICk7XG5cdH1cblxuXHQvKipcblx0ICogU2V0cyBvciByZW1vdmVzIC5mb2N1cyBjbGFzcyBvbiBhbiBlbGVtZW50LlxuXHQgKi9cblx0ZnVuY3Rpb24gdG9nZ2xlRm9jdXMoKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0Ly8gTW92ZSB1cCB0aHJvdWdoIHRoZSBhbmNlc3RvcnMgb2YgdGhlIGN1cnJlbnQgbGluayB1bnRpbCB3ZSBoaXQgLm5hdi1tZW51LlxuXHRcdHdoaWxlICggLTEgPT09IHNlbGYuY2xhc3NOYW1lLmluZGV4T2YoICdtZW51JyApICkge1xuXG5cdFx0XHQvLyBPbiBsaSBlbGVtZW50cyB0b2dnbGUgdGhlIGNsYXNzIC5mb2N1cy5cblx0XHRcdGlmICggJ2xpJyA9PT0gc2VsZi50YWdOYW1lLnRvTG93ZXJDYXNlKCkgKSB7XG5cdFx0XHRcdGlmICggLTEgIT09IHNlbGYuY2xhc3NOYW1lLmluZGV4T2YoICdmb2N1cycgKSApIHtcblx0XHRcdFx0XHRzZWxmLmNsYXNzTmFtZSA9IHNlbGYuY2xhc3NOYW1lLnJlcGxhY2UoICcgZm9jdXMnLCAnJyApO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHNlbGYuY2xhc3NOYW1lICs9ICcgZm9jdXMnO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYgPSBzZWxmLnBhcmVudEVsZW1lbnQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIFRvZ2dsZXMgYGZvY3VzYCBjbGFzcyB0byBhbGxvdyBzdWJtZW51IGFjY2VzcyBvbiB0YWJsZXRzLlxuXHQgKi9cblx0KCBmdW5jdGlvbiggY29udGFpbmVyICkge1xuXHRcdHZhciB0b3VjaFN0YXJ0Rm4sIGksXG5cdFx0XHRwYXJlbnRMaW5rID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoICcubWVudS1pdGVtLWhhcy1jaGlsZHJlbiA+IGEsIC5wYWdlX2l0ZW1faGFzX2NoaWxkcmVuID4gYScgKTtcblxuXHRcdGlmICggJ29udG91Y2hzdGFydCcgaW4gd2luZG93ICkge1xuXHRcdFx0dG91Y2hTdGFydEZuID0gZnVuY3Rpb24oIGUgKSB7XG5cdFx0XHRcdHZhciBtZW51SXRlbSA9IHRoaXMucGFyZW50Tm9kZSwgaTtcblxuXHRcdFx0XHRpZiAoICEgbWVudUl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKCAnZm9jdXMnICkgKSB7XG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdGZvciAoIGkgPSAwOyBpIDwgbWVudUl0ZW0ucGFyZW50Tm9kZS5jaGlsZHJlbi5sZW5ndGg7ICsraSApIHtcblx0XHRcdFx0XHRcdGlmICggbWVudUl0ZW0gPT09IG1lbnVJdGVtLnBhcmVudE5vZGUuY2hpbGRyZW5baV0gKSB7XG5cdFx0XHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0bWVudUl0ZW0ucGFyZW50Tm9kZS5jaGlsZHJlbltpXS5jbGFzc0xpc3QucmVtb3ZlKCAnZm9jdXMnICk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdG1lbnVJdGVtLmNsYXNzTGlzdC5hZGQoICdmb2N1cycgKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRtZW51SXRlbS5jbGFzc0xpc3QucmVtb3ZlKCAnZm9jdXMnICk7XG5cdFx0XHRcdH1cblx0XHRcdH07XG5cblx0XHRcdGZvciAoIGkgPSAwOyBpIDwgcGFyZW50TGluay5sZW5ndGg7ICsraSApIHtcblx0XHRcdFx0cGFyZW50TGlua1tpXS5hZGRFdmVudExpc3RlbmVyKCAndG91Y2hzdGFydCcsIHRvdWNoU3RhcnRGbiwgZmFsc2UgKTtcblx0XHRcdH1cblx0XHR9XG5cdH0oIGNvbnRhaW5lciApICk7XG59ICkoKTtcblxuLy8gdXNlciBhY2NvdW50IG5hdmlnYXRpb24gY2FuIGJlIGEgZHJvcGRvd25cbmpRdWVyeSggZG9jdW1lbnQgKS5yZWFkeSggZnVuY3Rpb24oICQgKSB7XG5cdC8vIGhpZGUgbWVudVxuXHRpZiAoJCgnI3VzZXItYWNjb3VudC1hY2Nlc3MgdWwnKS5sZW5ndGggPiAwICkge1xuXHRcdCQoJyN1c2VyLWFjY291bnQtYWNjZXNzID4gbGkgPiBhJykub24oICdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XG5cdFx0XHQkKCcjdXNlci1hY2NvdW50LWFjY2VzcyB1bCcpLnRvZ2dsZUNsYXNzKCAndmlzaWJsZScgKTtcblx0XHRcdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cdFx0fSk7XG5cdH1cblxufSk7XG4iXX0=
