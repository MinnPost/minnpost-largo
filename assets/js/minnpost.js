'use strict';

function mp_analytics_tracking_event(type, category, action, label, value) {
	if (typeof ga !== 'undefined') {
		if (typeof value === 'undefined') {
			ga('send', type, category, action, label);
		} else {
			ga('send', type, category, action, label, value);
		}
	} else {
		return;
	}
}

function trackShare(text, position) {

	// if a not logged in user tries to email, don't count that as a share
	if (!$('body ').hasClass('logged-in') && 'Email' === text) {
		return;
	}

	// track as an event, and as social if it is twitter or fb
	mp_analytics_tracking_event('event', 'Share - ' + position, text, location.pathname);
	if ('undefined' !== typeof ga) {
		if ('Facebook' === text || 'Twitter' === text) {
			if (text == 'Facebook') {
				ga('send', 'social', text, 'Share', location.pathname);
			} else {
				ga('send', 'social', text, 'Tweet', location.pathname);
			}
		}
	} else {
		return;
	}
}

jQuery('.m-entry-share-top a').click(function ($) {
	var text = $(this).text().trim();
	var position = 'top';
	trackShare(text, position);
});

jQuery('.m-entry-share-bottom a').click(function ($) {
	var text = $(this).text().trim();
	var position = 'bottom';
	trackShare(text, position);
});

$('#navigation-featured a').click(function (e) {
	mp_analytics_tracking_event('event', 'Featured Bar Link', 'Click', this.href);
});
$('a.glean-sidebar').click(function (e) {
	mp_analytics_tracking_event('event', 'Sidebar Support Link', 'Click', this.href);
});

$('a', $('#o-site-sidebar')).click(function (e) {
	var widget_title = $(this).closest('.m-widget').find('h3').text();
	var sidebar_section_title = '';
	if (widget_title === '') {
		//sidebar_section_title = $(this).closest('.node-type-spill').find('.node-title a').text();
	} else {
		sidebar_section_title = widget_title;
	}
	mp_analytics_tracking_event('event', 'Sidebar Link', 'Click', sidebar_section_title);
});

jQuery(document).ready(function ($) {
	if ('undefined' !== typeof minnpost_membership_data && '' !== minnpost_membership_data.url_access_level) {
		var type = 'event';
		var category = 'Member Content';
		var label = location.pathname; // i think we could possibly put some grouping here, but we don't necessarily have access to one and maybe it's not worthwhile yet
		var action = 'Blocked';
		if (true === minnpost_membership_data.current_user.can_access) {
			action = 'Shown';
		}
		mp_analytics_tracking_event(type, category, action, label);
	}
});
'use strict';

jQuery(document).ready(function ($) {
	"use strict";

	if ($('.m-form-newsletter-shortcode').length > 0) {
		$('.m-form-newsletter-shortcode fieldset').before('<div class="m-hold-message"></div>');
		$('.m-form-newsletter-shortcode form').submit(function (event) {
			var that = this;
			event.preventDefault(); // Prevent the default form submit.
			var button = $('button', this);
			button.prop('disabled', true);
			button.text('Processing');
			// serialize the form data
			var ajax_form_data = $(this).serialize();
			//add our own ajax check as X-Requested-With is not always reliable
			ajax_form_data = ajax_form_data + '&ajaxrequest=true&subscribe';
			$.ajax({
				url: params.ajaxurl, // domain/wp-admin/admin-ajax.php
				type: 'post',
				dataType: 'json',
				data: ajax_form_data
			}).done(function (response) {
				// response from the PHP action
				var message = '';
				if (response.success === true) {
					$('fieldset', that).hide();
					button.text('Thanks');
					var analytics_action = 'Signup';
					switch (response.data.user_status) {
						case 'existing':
							analytics_action = 'Update';
							message = 'Thanks for updating your email preferences. They will go into effect immediately.';
							break;
						case 'new':
							analytics_action = 'Signup';
							message = 'We have added you to the MinnPost mailing list.';
							break;
						case 'pending':
							analytics_action = 'Signup';
							message = 'We have added you to the MinnPost mailing list. You will need to click the confirmation link in the email we sent to begin receiving messages.';
							break;
					}
					if ('function' === typeof mp_analytics_tracking_event) {
						mp_analytics_tracking_event('event', 'Newsletter', analytics_action, location.pathname);
					}
				} else {
					button.prop('disabled', false);
					button.text('Subscribe');
					if ('function' === typeof mp_analytics_tracking_event) {
						mp_analytics_tracking_event('event', 'Newsletter', 'Fail', location.pathname);
					}
				}
				$('.m-hold-message').html('<div class="m-form-message m-form-message-info">' + message + '</div>');
			}).fail(function (response) {
				$('.m-hold-message').html('<div class="m-form-message m-form-message-info">An error has occured. Please try again.</div>');
				button.prop('disabled', false);
				button.text('Subscribe');
				if ('function' === typeof mp_analytics_tracking_event) {
					mp_analytics_tracking_event('event', 'Newsletter', 'Fail', location.pathname);
				}
			}).always(function () {
				event.target.reset();
			});
		});
	}
});
'use strict';

/**
 * File navigation.js.
 *
 * Handles toggling the navigation menu for small screens and enables TAB key
 * navigation support for dropdown menus.
 */
(function () {
	var container, button, menu, links, i, len;

	container = document.getElementById('navigation-primary');
	if (!container) {
		return;
	}

	button = container.getElementsByTagName('button')[0];
	if ('undefined' === typeof button) {
		return;
	}

	menu = container.getElementsByTagName('ul')[0];

	// Hide menu toggle button if menu is empty and return early.
	if ('undefined' === typeof menu) {
		button.style.display = 'none';
		return;
	}

	menu.setAttribute('aria-expanded', 'false');
	if (-1 === menu.className.indexOf('menu')) {
		menu.className += ' menu';
	}

	button.onclick = function () {
		if (-1 !== container.className.indexOf('toggled')) {
			container.className = container.className.replace(' toggled', '');
			button.setAttribute('aria-expanded', 'false');
			menu.setAttribute('aria-expanded', 'false');
		} else {
			container.className += ' toggled';
			button.setAttribute('aria-expanded', 'true');
			menu.setAttribute('aria-expanded', 'true');
		}
	};

	// Get all the link elements within the menu.
	links = menu.getElementsByTagName('a');

	// Each time a menu link is focused or blurred, toggle focus.
	for (i = 0, len = links.length; i < len; i++) {
		links[i].addEventListener('focus', toggleFocus, true);
		links[i].addEventListener('blur', toggleFocus, true);
	}

	/**
  * Sets or removes .focus class on an element.
  */
	function toggleFocus() {
		var self = this;

		// Move up through the ancestors of the current link until we hit .nav-menu.
		while (-1 === self.className.indexOf('menu')) {

			// On li elements toggle the class .focus.
			if ('li' === self.tagName.toLowerCase()) {
				if (-1 !== self.className.indexOf('focus')) {
					self.className = self.className.replace(' focus', '');
				} else {
					self.className += ' focus';
				}
			}

			self = self.parentElement;
		}
	}

	/**
  * Toggles `focus` class to allow submenu access on tablets.
  */
	(function (container) {
		var touchStartFn,
		    i,
		    parentLink = container.querySelectorAll('.menu-item-has-children > a, .page_item_has_children > a');

		if ('ontouchstart' in window) {
			touchStartFn = function touchStartFn(e) {
				var menuItem = this.parentNode,
				    i;

				if (!menuItem.classList.contains('focus')) {
					e.preventDefault();
					for (i = 0; i < menuItem.parentNode.children.length; ++i) {
						if (menuItem === menuItem.parentNode.children[i]) {
							continue;
						}
						menuItem.parentNode.children[i].classList.remove('focus');
					}
					menuItem.classList.add('focus');
				} else {
					menuItem.classList.remove('focus');
				}
			};

			for (i = 0; i < parentLink.length; ++i) {
				parentLink[i].addEventListener('touchstart', touchStartFn, false);
			}
		}
	})(container);
})();

// user account navigation can be a dropdown
jQuery(document).ready(function ($) {
	// hide menu
	if ($('#user-account-access ul').length > 0) {
		$('#user-account-access > li > a').on('click', function (event) {
			$('#user-account-access ul').toggleClass('visible');
			event.preventDefault();
		});
	}
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFuYWx5dGljcy5qcyIsImZvcm1zLmpzIiwibmF2aWdhdGlvbi5qcyJdLCJuYW1lcyI6WyJtcF9hbmFseXRpY3NfdHJhY2tpbmdfZXZlbnQiLCJ0eXBlIiwiY2F0ZWdvcnkiLCJhY3Rpb24iLCJsYWJlbCIsInZhbHVlIiwiZ2EiLCJ0cmFja1NoYXJlIiwidGV4dCIsInBvc2l0aW9uIiwiJCIsImhhc0NsYXNzIiwibG9jYXRpb24iLCJwYXRobmFtZSIsImpRdWVyeSIsImNsaWNrIiwidHJpbSIsImUiLCJocmVmIiwid2lkZ2V0X3RpdGxlIiwiY2xvc2VzdCIsImZpbmQiLCJzaWRlYmFyX3NlY3Rpb25fdGl0bGUiLCJkb2N1bWVudCIsInJlYWR5IiwibWlubnBvc3RfbWVtYmVyc2hpcF9kYXRhIiwidXJsX2FjY2Vzc19sZXZlbCIsImN1cnJlbnRfdXNlciIsImNhbl9hY2Nlc3MiLCJsZW5ndGgiLCJiZWZvcmUiLCJzdWJtaXQiLCJldmVudCIsInRoYXQiLCJwcmV2ZW50RGVmYXVsdCIsImJ1dHRvbiIsInByb3AiLCJhamF4X2Zvcm1fZGF0YSIsInNlcmlhbGl6ZSIsImFqYXgiLCJ1cmwiLCJwYXJhbXMiLCJhamF4dXJsIiwiZGF0YVR5cGUiLCJkYXRhIiwiZG9uZSIsInJlc3BvbnNlIiwibWVzc2FnZSIsInN1Y2Nlc3MiLCJoaWRlIiwiYW5hbHl0aWNzX2FjdGlvbiIsInVzZXJfc3RhdHVzIiwiaHRtbCIsImZhaWwiLCJhbHdheXMiLCJ0YXJnZXQiLCJyZXNldCIsImNvbnRhaW5lciIsIm1lbnUiLCJsaW5rcyIsImkiLCJsZW4iLCJnZXRFbGVtZW50QnlJZCIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwic3R5bGUiLCJkaXNwbGF5Iiwic2V0QXR0cmlidXRlIiwiY2xhc3NOYW1lIiwiaW5kZXhPZiIsIm9uY2xpY2siLCJyZXBsYWNlIiwiYWRkRXZlbnRMaXN0ZW5lciIsInRvZ2dsZUZvY3VzIiwic2VsZiIsInRhZ05hbWUiLCJ0b0xvd2VyQ2FzZSIsInBhcmVudEVsZW1lbnQiLCJ0b3VjaFN0YXJ0Rm4iLCJwYXJlbnRMaW5rIiwicXVlcnlTZWxlY3RvckFsbCIsIndpbmRvdyIsIm1lbnVJdGVtIiwicGFyZW50Tm9kZSIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwiY2hpbGRyZW4iLCJyZW1vdmUiLCJhZGQiLCJvbiIsInRvZ2dsZUNsYXNzIl0sIm1hcHBpbmdzIjoiOztBQUFBLFNBQVNBLDJCQUFULENBQXNDQyxJQUF0QyxFQUE0Q0MsUUFBNUMsRUFBc0RDLE1BQXRELEVBQThEQyxLQUE5RCxFQUFxRUMsS0FBckUsRUFBNkU7QUFDNUUsS0FBSyxPQUFPQyxFQUFQLEtBQWMsV0FBbkIsRUFBaUM7QUFDaEMsTUFBSyxPQUFPRCxLQUFQLEtBQWlCLFdBQXRCLEVBQW9DO0FBQ25DQyxNQUFJLE1BQUosRUFBWUwsSUFBWixFQUFrQkMsUUFBbEIsRUFBNEJDLE1BQTVCLEVBQW9DQyxLQUFwQztBQUNBLEdBRkQsTUFFTztBQUNORSxNQUFJLE1BQUosRUFBWUwsSUFBWixFQUFrQkMsUUFBbEIsRUFBNEJDLE1BQTVCLEVBQW9DQyxLQUFwQyxFQUEyQ0MsS0FBM0M7QUFDQTtBQUNELEVBTkQsTUFNTztBQUNOO0FBQ0E7QUFDRDs7QUFFRCxTQUFTRSxVQUFULENBQXFCQyxJQUFyQixFQUEyQkMsUUFBM0IsRUFBc0M7O0FBRXJDO0FBQ0EsS0FBSyxDQUFFQyxFQUFHLE9BQUgsRUFBWUMsUUFBWixDQUFzQixXQUF0QixDQUFGLElBQXdDLFlBQVlILElBQXpELEVBQWdFO0FBQy9EO0FBQ0E7O0FBRUQ7QUFDQVIsNkJBQTZCLE9BQTdCLEVBQXNDLGFBQWFTLFFBQW5ELEVBQTZERCxJQUE3RCxFQUFtRUksU0FBU0MsUUFBNUU7QUFDQSxLQUFLLGdCQUFnQixPQUFPUCxFQUE1QixFQUFpQztBQUNoQyxNQUFLLGVBQWVFLElBQWYsSUFBdUIsY0FBY0EsSUFBMUMsRUFBaUQ7QUFDaEQsT0FBS0EsUUFBUSxVQUFiLEVBQTBCO0FBQ3pCRixPQUFJLE1BQUosRUFBWSxRQUFaLEVBQXNCRSxJ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QUFwQixDQUE2QnpCLENBQTdCLEVBQWdDdUIsU0FBaEMsQ0FBMENHLE1BQTFDLENBQWtELE9BQWxEO0FBQ0E7QUFDREwsY0FBU0UsU0FBVCxDQUFtQkksR0FBbkIsQ0FBd0IsT0FBeEI7QUFDQSxLQVRELE1BU087QUFDTk4sY0FBU0UsU0FBVCxDQUFtQkcsTUFBbkIsQ0FBMkIsT0FBM0I7QUFDQTtBQUNELElBZkQ7O0FBaUJBLFFBQU0xQixJQUFJLENBQVYsRUFBYUEsSUFBSWtCLFdBQVdqRCxNQUE1QixFQUFvQyxFQUFFK0IsQ0FBdEMsRUFBMEM7QUFDekNrQixlQUFXbEIsQ0FBWCxFQUFjVyxnQkFBZCxDQUFnQyxZQUFoQyxFQUE4Q00sWUFBOUMsRUFBNEQsS0FBNUQ7QUFDQTtBQUNEO0FBQ0QsRUExQkMsRUEwQkNwQixTQTFCRCxDQUFGO0FBMkJBLENBbkdEOztBQXFHQTtBQUNBM0MsT0FBUVMsUUFBUixFQUFtQkMsS0FBbkIsQ0FBMEIsVUFBVWQsQ0FBVixFQUFjO0FBQ3ZDO0FBQ0EsS0FBSUEsRUFBRSx5QkFBRixFQUE2Qm1CLE1BQTdCLEdBQXNDLENBQTFDLEVBQThDO0FBQzdDbkIsSUFBRSwrQkFBRixFQUFtQzhFLEVBQW5DLENBQXVDLE9BQXZDLEVBQWdELFVBQVN4RCxLQUFULEVBQWdCO0FBQy9EdEIsS0FBRSx5QkFBRixFQUE2QitFLFdBQTdCLENBQTBDLFNBQTFDO0FBQ0F6RCxTQUFNRSxjQUFOO0FBQ0EsR0FIRDtBQUlBO0FBRUQsQ0FURCIsImZpbGUiOiJtaW5ucG9zdC5qcyIsInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIG1wX2FuYWx5dGljc190cmFja2luZ19ldmVudCggdHlwZSwgY2F0ZWdvcnksIGFjdGlvbiwgbGFiZWwsIHZhbHVlICkge1xuXHRpZiAoIHR5cGVvZiBnYSAhPT0gJ3VuZGVmaW5lZCcgKSB7XG5cdFx0aWYgKCB0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnICkge1xuXHRcdFx0Z2EoICdzZW5kJywgdHlwZSwgY2F0ZWdvcnksIGFjdGlvbiwgbGFiZWwgKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Z2EoICdzZW5kJywgdHlwZSwgY2F0ZWdvcnksIGFjdGlvbiwgbGFiZWwsIHZhbHVlICk7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdHJldHVybjtcblx0fVxufVxuXG5mdW5jdGlvbiB0cmFja1NoYXJlKCB0ZXh0LCBwb3NpdGlvbiApIHtcblxuXHQvLyBpZiBhIG5vdCBsb2dnZWQgaW4gdXNlciB0cmllcyB0byBlbWFpbCwgZG9uJ3QgY291bnQgdGhhdCBhcyBhIHNoYXJlXG5cdGlmICggISAkKCAnYm9keSAnKS5oYXNDbGFzcyggJ2xvZ2dlZC1pbicpICYmICdFbWFpbCcgPT09IHRleHQgKSB7XG5cdFx0cmV0dXJuO1xuXHR9XG5cblx0Ly8gdHJhY2sgYXMgYW4gZXZlbnQsIGFuZCBhcyBzb2NpYWwgaWYgaXQgaXMgdHdpdHRlciBvciBmYlxuXHRtcF9hbmFseXRpY3NfdHJhY2tpbmdfZXZlbnQoICdldmVudCcsICdTaGFyZSAtICcgKyBwb3NpdGlvbiwgdGV4dCwgbG9jYXRpb24ucGF0aG5hbWUgKTtcblx0aWYgKCAndW5kZWZpbmVkJyAhPT0gdHlwZW9mIGdhICkge1xuXHRcdGlmICggJ0ZhY2Vib29rJyA9PT0gdGV4dCB8fCAnVHdpdHRlcicgPT09IHRleHQgKSB7XG5cdFx0XHRpZiAoIHRleHQgPT0gJ0ZhY2Vib29rJyApIHtcblx0XHRcdFx0Z2EoICdzZW5kJywgJ3NvY2lhbCcsIHRleHQsICdTaGFyZScsIGxvY2F0aW9uLnBhdGhuYW1lICk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRnYSggJ3NlbmQnLCAnc29jaWFsJywgdGV4dCwgJ1R3ZWV0JywgbG9jYXRpb24ucGF0aG5hbWUgKTtcblx0XHRcdH1cblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0cmV0dXJuO1xuXHR9XG59XG5cbmpRdWVyeSAoICcubS1lbnRyeS1zaGFyZS10b3AgYScgKS5jbGljayggZnVuY3Rpb24oICQgKSB7XG5cdHZhciB0ZXh0ID0gJCggdGhpcyApLnRleHQoKS50cmltKCk7XG5cdHZhciBwb3NpdGlvbiA9ICd0b3AnO1xuXHR0cmFja1NoYXJlKCB0ZXh0LCBwb3NpdGlvbiApO1xufSk7XG5cbmpRdWVyeSAoICcubS1lbnRyeS1zaGFyZS1ib3R0b20gYScgKS5jbGljayggZnVuY3Rpb24oICQgKSB7XG5cdHZhciB0ZXh0ID0gJCggdGhpcyApLnRleHQoKS50cmltKCk7XG5cdHZhciBwb3NpdGlvbiA9ICdib3R0b20nO1xuXHR0cmFja1NoYXJlKCB0ZXh0LCBwb3NpdGlvbiApO1xufSk7XG5cbiQoICcjbmF2aWdhdGlvbi1mZWF0dXJlZCBhJyApLmNsaWNrKCBmdW5jdGlvbiggZSApIHtcblx0bXBfYW5hbHl0aWNzX3RyYWNraW5nX2V2ZW50KCAnZXZlbnQnLCAnRmVhdHVyZWQgQmFyIExpbmsnLCAnQ2xpY2snLCB0aGlzLmhyZWYgKTtcbn0pO1xuJCggJ2EuZ2xlYW4tc2lkZWJhcicgKS5jbGljayggZnVuY3Rpb24oIGUgKSB7XG5cdG1wX2FuYWx5dGljc190cmFja2luZ19ldmVudCggJ2V2ZW50JywgJ1NpZGViYXIgU3VwcG9ydCBMaW5rJywgJ0NsaWNrJywgdGhpcy5ocmVmICk7XG59KTtcblxuJCggJ2EnLCAkKCAnI28tc2l0ZS1zaWRlYmFyJyApICkuY2xpY2soIGZ1bmN0aW9uKCBlICkge1xuXHR2YXIgd2lkZ2V0X3RpdGxlID0gJCh0aGlzKS5jbG9zZXN0KCcubS13aWRnZXQnKS5maW5kKCdoMycpLnRleHQoKTtcblx0dmFyIHNpZGViYXJfc2VjdGlvbl90aXRsZSA9ICcnO1xuXHRpZiAod2lkZ2V0X3RpdGxlID09PSAnJykge1xuXHRcdC8vc2lkZWJhcl9zZWN0aW9uX3RpdGxlID0gJCh0aGlzKS5jbG9zZXN0KCcubm9kZS10eXBlLXNwaWxsJykuZmluZCgnLm5vZGUtdGl0bGUgYScpLnRleHQoKTtcblx0fSBlbHNlIHtcblx0XHRzaWRlYmFyX3NlY3Rpb25fdGl0bGUgPSB3aWRnZXRfdGl0bGU7XG5cdH1cblx0bXBfYW5hbHl0aWNzX3RyYWNraW5nX2V2ZW50KCdldmVudCcsICdTaWRlYmFyIExpbmsnLCAnQ2xpY2snLCBzaWRlYmFyX3NlY3Rpb25fdGl0bGUpO1xufSk7XG5cbmpRdWVyeSggZG9jdW1lbnQgKS5yZWFkeSggZnVuY3Rpb24gKCAkICkge1xuXHRpZiAoICd1bmRlZmluZWQnICE9PSB0eXBlb2YgbWlubnBvc3RfbWVtYmVyc2hpcF9kYXRhICYmICcnICE9PSBtaW5ucG9zdF9tZW1iZXJzaGlwX2RhdGEudXJsX2FjY2Vzc19sZXZlbCApIHtcblx0XHR2YXIgdHlwZSA9ICdldmVudCc7XG5cdFx0dmFyIGNhdGVnb3J5ID0gJ01lbWJlciBDb250ZW50Jztcblx0XHR2YXIgbGFiZWwgPSBsb2NhdGlvbi5wYXRobmFtZTsgLy8gaSB0aGluayB3ZSBjb3VsZCBwb3NzaWJseSBwdXQgc29tZSBncm91cGluZyBoZXJlLCBidXQgd2UgZG9uJ3QgbmVjZXNzYXJpbHkgaGF2ZSBhY2Nlc3MgdG8gb25lIGFuZCBtYXliZSBpdCdzIG5vdCB3b3J0aHdoaWxlIHlldFxuXHRcdHZhciBhY3Rpb24gPSAnQmxvY2tlZCc7XG5cdFx0aWYgKCB0cnVlID09PSBtaW5ucG9zdF9tZW1iZXJzaGlwX2RhdGEuY3VycmVudF91c2VyLmNhbl9hY2Nlc3MgKSB7XG5cdFx0XHRhY3Rpb24gPSAnU2hvd24nO1xuXHRcdH1cblx0XHRtcF9hbmFseXRpY3NfdHJhY2tpbmdfZXZlbnQoIHR5cGUsIGNhdGVnb3J5LCBhY3Rpb24sIGxhYmVsICk7XG5cdH1cbn0pO1xuIiwialF1ZXJ5KCBkb2N1bWVudCApLnJlYWR5KCBmdW5jdGlvbiggJCApIHtcblx0XCJ1c2Ugc3RyaWN0XCI7XG5cdGlmICggJCgnLm0tZm9ybS1uZXdzbGV0dGVyLXNob3J0Y29kZScpLmxlbmd0aCA+IDAgKSB7XG5cdFx0JCgnLm0tZm9ybS1uZXdzbGV0dGVyLXNob3J0Y29kZSBmaWVsZHNldCcpLmJlZm9yZSgnPGRpdiBjbGFzcz1cIm0taG9sZC1tZXNzYWdlXCI+PC9kaXY+Jyk7XG5cdFx0JCgnLm0tZm9ybS1uZXdzbGV0dGVyLXNob3J0Y29kZSBmb3JtJykuc3VibWl0KGZ1bmN0aW9uKGV2ZW50KSB7XG5cdFx0XHR2YXIgdGhhdCA9IHRoaXM7XG5cdFx0XHRldmVudC5wcmV2ZW50RGVmYXVsdCgpOyAvLyBQcmV2ZW50IHRoZSBkZWZhdWx0IGZvcm0gc3VibWl0LlxuXHRcdFx0dmFyIGJ1dHRvbiA9ICQoJ2J1dHRvbicsIHRoaXMpO1xuXHRcdFx0YnV0dG9uLnByb3AoJ2Rpc2FibGVkJywgdHJ1ZSk7XG5cdFx0XHRidXR0b24udGV4dCgnUHJvY2Vzc2luZycpO1xuXHRcdFx0Ly8gc2VyaWFsaXplIHRoZSBmb3JtIGRhdGFcblx0XHRcdHZhciBhamF4X2Zvcm1fZGF0YSA9ICQodGhpcykuc2VyaWFsaXplKCk7XG5cdFx0XHQvL2FkZCBvdXIgb3duIGFqYXggY2hlY2sgYXMgWC1SZXF1ZXN0ZWQtV2l0aCBpcyBub3QgYWx3YXlzIHJlbGlhYmxlXG5cdFx0XHRhamF4X2Zvcm1fZGF0YSA9IGFqYXhfZm9ybV9kYXRhICsgJyZhamF4cmVxdWVzdD10cnVlJnN1YnNjcmliZSc7XG5cdFx0XHQkLmFqYXgoe1xuXHRcdFx0XHR1cmw6IHBhcmFtcy5hamF4dXJsLCAvLyBkb21haW4vd3AtYWRtaW4vYWRtaW4tYWpheC5waHBcblx0XHRcdFx0dHlwZTogJ3Bvc3QnLFxuXHRcdFx0XHRkYXRhVHlwZSA6ICdqc29uJyxcblx0XHRcdFx0ZGF0YTogYWpheF9mb3JtX2RhdGFcblx0XHRcdH0pXG5cdFx0XHQuZG9uZShmdW5jdGlvbihyZXNwb25zZSkgeyAvLyByZXNwb25zZSBmcm9tIHRoZSBQSFAgYWN0aW9uXG5cdFx0XHRcdHZhciBtZXNzYWdlID0gJyc7XG5cdFx0XHRcdGlmICggcmVzcG9uc2Uuc3VjY2VzcyA9PT0gdHJ1ZSApIHtcblx0XHRcdFx0XHQkKCdmaWVsZHNldCcsIHRoYXQpLmhpZGUoKTtcblx0XHRcdFx0XHRidXR0b24udGV4dCgnVGhhbmtzJyk7XG5cdFx0XHRcdFx0dmFyIGFuYWx5dGljc19hY3Rpb24gPSAnU2lnbnVwJztcblx0XHRcdFx0XHRzd2l0Y2ggKHJlc3BvbnNlLmRhdGEudXNlcl9zdGF0dXMpIHtcblx0XHRcdFx0XHRcdGNhc2UgJ2V4aXN0aW5nJzpcblx0XHRcdFx0XHRcdFx0YW5hbHl0aWNzX2FjdGlvbiA9ICdVcGRhdGUnO1xuXHRcdFx0XHRcdFx0XHRtZXNzYWdlID0gJ1RoYW5rcyBmb3IgdXBkYXRpbmcgeW91ciBlbWFpbCBwcmVmZXJlbmNlcy4gVGhleSB3aWxsIGdvIGludG8gZWZmZWN0IGltbWVkaWF0ZWx5Lic7XG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0Y2FzZSAnbmV3Jzpcblx0XHRcdFx0XHRcdFx0YW5hbHl0aWNzX2FjdGlvbiA9ICdTaWdudXAnO1xuXHRcdFx0XHRcdFx0XHRtZXNzYWdlID0gJ1dlIGhhdmUgYWRkZWQgeW91IHRvIHRoZSBNaW5uUG9zdCBtYWlsaW5nIGxpc3QuJztcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRjYXNlICdwZW5kaW5nJzpcblx0XHRcdFx0XHRcdFx0YW5hbHl0aWNzX2FjdGlvbiA9ICdTaWdudXAnO1xuXHRcdFx0XHRcdFx0XHRtZXNzYWdlID0gJ1dlIGhhdmUgYWRkZWQgeW91IHRvIHRoZSBNaW5uUG9zdCBtYWlsaW5nIGxpc3QuIFlvdSB3aWxsIG5lZWQgdG8gY2xpY2sgdGhlIGNvbmZpcm1hdGlvbiBsaW5rIGluIHRoZSBlbWFpbCB3ZSBzZW50IHRvIGJlZ2luIHJlY2VpdmluZyBtZXNzYWdlcy4nO1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKCAnZnVuY3Rpb24nID09PSB0eXBlb2YgbXBfYW5hbHl0aWNzX3RyYWNraW5nX2V2ZW50ICkge1xuXHRcdFx0XHRcdFx0bXBfYW5hbHl0aWNzX3RyYWNraW5nX2V2ZW50KCAnZXZlbnQnLCAnTmV3c2xldHRlcicsIGFuYWx5dGljc19hY3Rpb24sIGxvY2F0aW9uLnBhdGhuYW1lICk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGJ1dHRvbi5wcm9wKCdkaXNhYmxlZCcsIGZhbHNlKTtcblx0XHRcdFx0XHRidXR0b24udGV4dCgnU3Vic2NyaWJlJyk7XG5cdFx0XHRcdFx0aWYgKCAnZnVuY3Rpb24nID09PSB0eXBlb2YgbXBfYW5hbHl0aWNzX3RyYWNraW5nX2V2ZW50ICkge1xuXHRcdFx0XHRcdFx0bXBfYW5hbHl0aWNzX3RyYWNraW5nX2V2ZW50KCAnZXZlbnQnLCAnTmV3c2xldHRlcicsICdGYWlsJywgbG9jYXRpb24ucGF0aG5hbWUgKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdFx0JCgnLm0taG9sZC1tZXNzYWdlJykuaHRtbCgnPGRpdiBjbGFzcz1cIm0tZm9ybS1tZXNzYWdlIG0tZm9ybS1tZXNzYWdlLWluZm9cIj4nICsgbWVzc2FnZSArICc8L2Rpdj4nKTtcblx0XHRcdH0pXG5cdFx0XHQuZmFpbChmdW5jdGlvbihyZXNwb25zZSkge1xuXHRcdFx0XHQkKCcubS1ob2xkLW1lc3NhZ2UnKS5odG1sKCc8ZGl2IGNsYXNzPVwibS1mb3JtLW1lc3NhZ2UgbS1mb3JtLW1lc3NhZ2UtaW5mb1wiPkFuIGVycm9yIGhhcyBvY2N1cmVkLiBQbGVhc2UgdHJ5IGFnYWluLjwvZGl2PicpO1xuXHRcdFx0XHRidXR0b24ucHJvcCgnZGlzYWJsZWQnLCBmYWxzZSk7XG5cdFx0XHRcdGJ1dHRvbi50ZXh0KCdTdWJzY3JpYmUnKTtcblx0XHRcdFx0aWYgKCAnZnVuY3Rpb24nID09PSB0eXBlb2YgbXBfYW5hbHl0aWNzX3RyYWNraW5nX2V2ZW50ICkge1xuXHRcdFx0XHRcdG1wX2FuYWx5dGljc190cmFja2luZ19ldmVudCggJ2V2ZW50JywgJ05ld3NsZXR0ZXInLCAnRmFpbCcsIGxvY2F0aW9uLnBhdGhuYW1lICk7XG5cdFx0XHRcdH1cblx0XHRcdH0pXG5cdFx0XHQuYWx3YXlzKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRldmVudC50YXJnZXQucmVzZXQoKTtcblx0XHRcdH0pO1xuXHRcdH0pO1xuXHR9XG59KTsiLCIvKipcbiAqIEZpbGUgbmF2aWdhdGlvbi5qcy5cbiAqXG4gKiBIYW5kbGVzIHRvZ2dsaW5nIHRoZSBuYXZpZ2F0aW9uIG1lbnUgZm9yIHNtYWxsIHNjcmVlbnMgYW5kIGVuYWJsZXMgVEFCIGtleVxuICogbmF2aWdhdGlvbiBzdXBwb3J0IGZvciBkcm9wZG93biBtZW51cy5cbiAqL1xuKCBmdW5jdGlvbigpIHtcblx0dmFyIGNvbnRhaW5lciwgYnV0dG9uLCBtZW51LCBsaW5rcywgaSwgbGVuO1xuXG5cdGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCAnbmF2aWdhdGlvbi1wcmltYXJ5JyApO1xuXHRpZiAoICEgY29udGFpbmVyICkge1xuXHRcdHJldHVybjtcblx0fVxuXG5cdGJ1dHRvbiA9IGNvbnRhaW5lci5nZXRFbGVtZW50c0J5VGFnTmFtZSggJ2J1dHRvbicgKVswXTtcblx0aWYgKCAndW5kZWZpbmVkJyA9PT0gdHlwZW9mIGJ1dHRvbiApIHtcblx0XHRyZXR1cm47XG5cdH1cblxuXHRtZW51ID0gY29udGFpbmVyLmdldEVsZW1lbnRzQnlUYWdOYW1lKCAndWwnIClbMF07XG5cblx0Ly8gSGlkZSBtZW51IHRvZ2dsZSBidXR0b24gaWYgbWVudSBpcyBlbXB0eSBhbmQgcmV0dXJuIGVhcmx5LlxuXHRpZiAoICd1bmRlZmluZWQnID09PSB0eXBlb2YgbWVudSApIHtcblx0XHRidXR0b24uc3R5bGUuZGlzcGxheSA9ICdub25lJztcblx0XHRyZXR1cm47XG5cdH1cblxuXHRtZW51LnNldEF0dHJpYnV0ZSggJ2FyaWEtZXhwYW5kZWQnLCAnZmFsc2UnICk7XG5cdGlmICggLTEgPT09IG1lbnUuY2xhc3NOYW1lLmluZGV4T2YoICdtZW51JyApICkge1xuXHRcdG1lbnUuY2xhc3NOYW1lICs9ICcgbWVudSc7XG5cdH1cblxuXHRidXR0b24ub25jbGljayA9IGZ1bmN0aW9uKCkge1xuXHRcdGlmICggLTEgIT09IGNvbnRhaW5lci5jbGFzc05hbWUuaW5kZXhPZiggJ3RvZ2dsZWQnICkgKSB7XG5cdFx0XHRjb250YWluZXIuY2xhc3NOYW1lID0gY29udGFpbmVyLmNsYXNzTmFtZS5yZXBsYWNlKCAnIHRvZ2dsZWQnLCAnJyApO1xuXHRcdFx0YnV0dG9uLnNldEF0dHJpYnV0ZSggJ2FyaWEtZXhwYW5kZWQnLCAnZmFsc2UnICk7XG5cdFx0XHRtZW51LnNldEF0dHJpYnV0ZSggJ2FyaWEtZXhwYW5kZWQnLCAnZmFsc2UnICk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvbnRhaW5lci5jbGFzc05hbWUgKz0gJyB0b2dnbGVkJztcblx0XHRcdGJ1dHRvbi5zZXRBdHRyaWJ1dGUoICdhcmlhLWV4cGFuZGVkJywgJ3RydWUnICk7XG5cdFx0XHRtZW51LnNldEF0dHJpYnV0ZSggJ2FyaWEtZXhwYW5kZWQnLCAndHJ1ZScgKTtcblx0XHR9XG5cdH07XG5cblx0Ly8gR2V0IGFsbCB0aGUgbGluayBlbGVtZW50cyB3aXRoaW4gdGhlIG1lbnUuXG5cdGxpbmtzICAgID0gbWVudS5nZXRFbGVtZW50c0J5VGFnTmFtZSggJ2EnICk7XG5cblx0Ly8gRWFjaCB0aW1lIGEgbWVudSBsaW5rIGlzIGZvY3VzZWQgb3IgYmx1cnJlZCwgdG9nZ2xlIGZvY3VzLlxuXHRmb3IgKCBpID0gMCwgbGVuID0gbGlua3MubGVuZ3RoOyBpIDwgbGVuOyBpKysgKSB7XG5cdFx0bGlua3NbaV0uYWRkRXZlbnRMaXN0ZW5lciggJ2ZvY3VzJywgdG9nZ2xlRm9jdXMsIHRydWUgKTtcblx0XHRsaW5rc1tpXS5hZGRFdmVudExpc3RlbmVyKCAnYmx1cicsIHRvZ2dsZUZvY3VzLCB0cnVlICk7XG5cdH1cblxuXHQvKipcblx0ICogU2V0cyBvciByZW1vdmVzIC5mb2N1cyBjbGFzcyBvbiBhbiBlbGVtZW50LlxuXHQgKi9cblx0ZnVuY3Rpb24gdG9nZ2xlRm9jdXMoKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0Ly8gTW92ZSB1cCB0aHJvdWdoIHRoZSBhbmNlc3RvcnMgb2YgdGhlIGN1cnJlbnQgbGluayB1bnRpbCB3ZSBoaXQgLm5hdi1tZW51LlxuXHRcdHdoaWxlICggLTEgPT09IHNlbGYuY2xhc3NOYW1lLmluZGV4T2YoICdtZW51JyApICkge1xuXG5cdFx0XHQvLyBPbiBsaSBlbGVtZW50cyB0b2dnbGUgdGhlIGNsYXNzIC5mb2N1cy5cblx0XHRcdGlmICggJ2xpJyA9PT0gc2VsZi50YWdOYW1lLnRvTG93ZXJDYXNlKCkgKSB7XG5cdFx0XHRcdGlmICggLTEgIT09IHNlbGYuY2xhc3NOYW1lLmluZGV4T2YoICdmb2N1cycgKSApIHtcblx0XHRcdFx0XHRzZWxmLmNsYXNzTmFtZSA9IHNlbGYuY2xhc3NOYW1lLnJlcGxhY2UoICcgZm9jdXMnLCAnJyApO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHNlbGYuY2xhc3NOYW1lICs9ICcgZm9jdXMnO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYgPSBzZWxmLnBhcmVudEVsZW1lbnQ7XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIFRvZ2dsZXMgYGZvY3VzYCBjbGFzcyB0byBhbGxvdyBzdWJtZW51IGFjY2VzcyBvbiB0YWJsZXRzLlxuXHQgKi9cblx0KCBmdW5jdGlvbiggY29udGFpbmVyICkge1xuXHRcdHZhciB0b3VjaFN0YXJ0Rm4sIGksXG5cdFx0XHRwYXJlbnRMaW5rID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoICcubWVudS1pdGVtLWhhcy1jaGlsZHJlbiA+IGEsIC5wYWdlX2l0ZW1faGFzX2NoaWxkcmVuID4gYScgKTtcblxuXHRcdGlmICggJ29udG91Y2hzdGFydCcgaW4gd2luZG93ICkge1xuXHRcdFx0dG91Y2hTdGFydEZuID0gZnVuY3Rpb24oIGUgKSB7XG5cdFx0XHRcdHZhciBtZW51SXRlbSA9IHRoaXMucGFyZW50Tm9kZSwgaTtcblxuXHRcdFx0XHRpZiAoICEgbWVudUl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKCAnZm9jdXMnICkgKSB7XG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdGZvciAoIGkgPSAwOyBpIDwgbWVudUl0ZW0ucGFyZW50Tm9kZS5jaGlsZHJlbi5sZW5ndGg7ICsraSApIHtcblx0XHRcdFx0XHRcdGlmICggbWVudUl0ZW0gPT09IG1lbnVJdGVtLnBhcmVudE5vZGUuY2hpbGRyZW5baV0gKSB7XG5cdFx0XHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0bWVudUl0ZW0ucGFyZW50Tm9kZS5jaGlsZHJlbltpXS5jbGFzc0xpc3QucmVtb3ZlKCAnZm9jdXMnICk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdG1lbnVJdGVtLmNsYXNzTGlzdC5hZGQoICdmb2N1cycgKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRtZW51SXRlbS5jbGFzc0xpc3QucmVtb3ZlKCAnZm9jdXMnICk7XG5cdFx0XHRcdH1cblx0XHRcdH07XG5cblx0XHRcdGZvciAoIGkgPSAwOyBpIDwgcGFyZW50TGluay5sZW5ndGg7ICsraSApIHtcblx0XHRcdFx0cGFyZW50TGlua1tpXS5hZGRFdmVudExpc3RlbmVyKCAndG91Y2hzdGFydCcsIHRvdWNoU3RhcnRGbiwgZmFsc2UgKTtcblx0XHRcdH1cblx0XHR9XG5cdH0oIGNvbnRhaW5lciApICk7XG59ICkoKTtcblxuLy8gdXNlciBhY2NvdW50IG5hdmlnYXRpb24gY2FuIGJlIGEgZHJvcGRvd25cbmpRdWVyeSggZG9jdW1lbnQgKS5yZWFkeSggZnVuY3Rpb24oICQgKSB7XG5cdC8vIGhpZGUgbWVudVxuXHRpZiAoJCgnI3VzZXItYWNjb3VudC1hY2Nlc3MgdWwnKS5sZW5ndGggPiAwICkge1xuXHRcdCQoJyN1c2VyLWFjY291bnQtYWNjZXNzID4gbGkgPiBhJykub24oICdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XG5cdFx0XHQkKCcjdXNlci1hY2NvdW50LWFjY2VzcyB1bCcpLnRvZ2dsZUNsYXNzKCAndmlzaWJsZScgKTtcblx0XHRcdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cdFx0fSk7XG5cdH1cblxufSk7XG4iXX0=
