'use strict';

(function ($) {

	function mp_analytics_tracking_event(type, category, action, label, value) {
		if (typeof ga !== 'undefined') {
			if (typeof value === 'undefined') {
				ga('send', type, category, action, label);
			} else {
				ga('send', type, category, action, label, value);
			}
		} else {
			return;
		}
	}

	function trackShare(text, position) {

		// if a not logged in user tries to email, don't count that as a share
		if (!$('body ').hasClass('logged-in') && 'Email' === text) {
			return;
		}

		// track as an event, and as social if it is twitter or fb
		mp_analytics_tracking_event('event', 'Share - ' + position, text, location.pathname);
		if ('undefined' !== typeof ga) {
			if ('Facebook' === text || 'Twitter' === text) {
				if (text == 'Facebook') {
					ga('send', 'social', text, 'Share', location.pathname);
				} else {
					ga('send', 'social', text, 'Tweet', location.pathname);
				}
			}
		} else {
			return;
		}
	}

	$('.m-entry-share-top a').click(function (e) {
		var text = $(this).text().trim();
		var position = 'top';
		trackShare(text, position);
	});

	$('.m-entry-share-bottom a').click(function (e) {
		var text = $(this).text().trim();
		var position = 'bottom';
		trackShare(text, position);
	});

	$('#navigation-featured a').click(function (e) {
		mp_analytics_tracking_event('event', 'Featured Bar Link', 'Click', this.href);
	});
	$('a.glean-sidebar').click(function (e) {
		mp_analytics_tracking_event('event', 'Sidebar Support Link', 'Click', this.href);
	});

	$('a', $('.o-site-sidebar')).click(function (e) {
		var widget_title = $(this).closest('.m-widget').find('h3').text();
		var sidebar_section_title = '';
		if (widget_title === '') {
			//sidebar_section_title = $(this).closest('.node-type-spill').find('.node-title a').text();
		} else {
			sidebar_section_title = widget_title;
		}
		mp_analytics_tracking_event('event', 'Sidebar Link', 'Click', sidebar_section_title);
	});

	$(document).ready(function (e) {

		if ('undefined' !== typeof PUM) {
			var current_popup = PUM.getPopup($('.pum'));
			var settings = PUM.getSettings($('.pum'));
			var popup_id = settings.id;
			$(document).on('pumAfterOpen', function () {
				mp_analytics_tracking_event('event', 'Popup', 'Show', popup_id, { 'nonInteraction': 1 });
			});
			$(document).on('pumAfterClose', function () {
				var close_trigger = $.fn.popmake.last_close_trigger;
				if ('undefined' !== typeof close_trigger) {
					mp_analytics_tracking_event('event', 'Popup', close_trigger, popup_id, { 'nonInteraction': 1 });
				}
			});
			$('.message-close').click(function (e) {
				// user clicks link with close class
				var close_trigger = 'Close Button';
				mp_analytics_tracking_event('event', 'Popup', close_trigger, popup_id, { 'nonInteraction': 1 });
			});
			$('.message-login').click(function (e) {
				// user clicks link with login class
				var url = $(this).attr('href');
				mp_analytics_tracking_event('event', 'Popup', 'Login Link', url);
			});
			$('.pum-content a:not( .message-close, .pum-close, .message-login )').click(function (e) {
				// user clicks something that is not close text or close icon
				mp_analytics_tracking_event('event', 'Popup', 'Click', popup_id);
			});
		}

		if ('undefined' !== typeof minnpost_membership_data && '' !== minnpost_membership_data.url_access_level) {
			var type = 'event';
			var category = 'Member Content';
			var label = location.pathname; // i think we could possibly put some grouping here, but we don't necessarily have access to one and maybe it's not worthwhile yet
			var action = 'Blocked';
			if (true === minnpost_membership_data.current_user.can_access) {
				action = 'Shown';
			}
			mp_analytics_tracking_event(type, category, action, label);
		}
	});
})(jQuery);
'use strict';

jQuery(document).ready(function ($) {
	"use strict";

	if ($('.m-form-newsletter-shortcode').length > 0) {
		$('.m-form-newsletter-shortcode fieldset').before('<div class="m-hold-message"></div>');
		$('.m-form-newsletter-shortcode form').submit(function (event) {
			var that = this;
			event.preventDefault(); // Prevent the default form submit.
			var button = $('button', this);
			button.prop('disabled', true);
			button.text('Processing');
			// serialize the form data
			var ajax_form_data = $(this).serialize();
			//add our own ajax check as X-Requested-With is not always reliable
			ajax_form_data = ajax_form_data + '&ajaxrequest=true&subscribe';
			$.ajax({
				url: params.ajaxurl, // domain/wp-admin/admin-ajax.php
				type: 'post',
				dataType: 'json',
				data: ajax_form_data
			}).done(function (response) {
				// response from the PHP action
				var message = '';
				if (response.success === true) {
					$('fieldset', that).hide();
					button.text('Thanks');
					var analytics_action = 'Signup';
					switch (response.data.user_status) {
						case 'existing':
							analytics_action = 'Update';
							message = 'Thanks for updating your email preferences. They will go into effect immediately.';
							break;
						case 'new':
							analytics_action = 'Signup';
							message = 'We have added you to the MinnPost mailing list.';
							break;
						case 'pending':
							analytics_action = 'Signup';
							message = 'We have added you to the MinnPost mailing list. You will need to click the confirmation link in the email we sent to begin receiving messages.';
							break;
					}
					if ('function' === typeof mp_analytics_tracking_event) {
						mp_analytics_tracking_event('event', 'Newsletter', analytics_action, location.pathname);
					}
				} else {
					button.prop('disabled', false);
					button.text('Subscribe');
					if ('function' === typeof mp_analytics_tracking_event) {
						mp_analytics_tracking_event('event', 'Newsletter', 'Fail', location.pathname);
					}
				}
				$('.m-hold-message').html('<div class="m-form-message m-form-message-info">' + message + '</div>');
			}).fail(function (response) {
				$('.m-hold-message').html('<div class="m-form-message m-form-message-info">An error has occured. Please try again.</div>');
				button.prop('disabled', false);
				button.text('Subscribe');
				if ('function' === typeof mp_analytics_tracking_event) {
					mp_analytics_tracking_event('event', 'Newsletter', 'Fail', location.pathname);
				}
			}).always(function () {
				event.target.reset();
			});
		});
	}
});
'use strict';

/**
 * File navigation.js.
 *
 * Handles toggling the navigation menu for small screens and enables TAB key
 * navigation support for dropdown menus.
 */
(function () {
	var container, button, menu, links, i, len;

	container = document.getElementById('navigation-primary');
	if (!container) {
		return;
	}

	button = container.getElementsByTagName('button')[0];
	if ('undefined' === typeof button) {
		return;
	}

	menu = container.getElementsByTagName('ul')[0];

	// Hide menu toggle button if menu is empty and return early.
	if ('undefined' === typeof menu) {
		button.style.display = 'none';
		return;
	}

	menu.setAttribute('aria-expanded', 'false');
	if (-1 === menu.className.indexOf('menu')) {
		menu.className += ' menu';
	}

	button.onclick = function () {
		if (-1 !== container.className.indexOf('toggled')) {
			container.className = container.className.replace(' toggled', '');
			button.setAttribute('aria-expanded', 'false');
			menu.setAttribute('aria-expanded', 'false');
		} else {
			container.className += ' toggled';
			button.setAttribute('aria-expanded', 'true');
			menu.setAttribute('aria-expanded', 'true');
		}
	};

	// Get all the link elements within the menu.
	links = menu.getElementsByTagName('a');

	// Each time a menu link is focused or blurred, toggle focus.
	for (i = 0, len = links.length; i < len; i++) {
		links[i].addEventListener('focus', toggleFocus, true);
		links[i].addEventListener('blur', toggleFocus, true);
	}

	/**
  * Sets or removes .focus class on an element.
  */
	function toggleFocus() {
		var self = this;

		// Move up through the ancestors of the current link until we hit .nav-menu.
		while (-1 === self.className.indexOf('menu')) {

			// On li elements toggle the class .focus.
			if ('li' === self.tagName.toLowerCase()) {
				if (-1 !== self.className.indexOf('focus')) {
					self.className = self.className.replace(' focus', '');
				} else {
					self.className += ' focus';
				}
			}

			self = self.parentElement;
		}
	}

	/**
  * Toggles `focus` class to allow submenu access on tablets.
  */
	(function (container) {
		var touchStartFn,
		    i,
		    parentLink = container.querySelectorAll('.menu-item-has-children > a, .page_item_has_children > a');

		if ('ontouchstart' in window) {
			touchStartFn = function touchStartFn(e) {
				var menuItem = this.parentNode,
				    i;

				if (!menuItem.classList.contains('focus')) {
					e.preventDefault();
					for (i = 0; i < menuItem.parentNode.children.length; ++i) {
						if (menuItem === menuItem.parentNode.children[i]) {
							continue;
						}
						menuItem.parentNode.children[i].classList.remove('focus');
					}
					menuItem.classList.add('focus');
				} else {
					menuItem.classList.remove('focus');
				}
			};

			for (i = 0; i < parentLink.length; ++i) {
				parentLink[i].addEventListener('touchstart', touchStartFn, false);
			}
		}
	})(container);
})();

// user account navigation can be a dropdown
jQuery(document).ready(function ($) {
	// hide menu
	if ($('#user-account-access ul').length > 0) {
		$('#user-account-access > li > a').on('click', function (event) {
			$('#user-account-access ul').toggleClass('visible');
			event.preventDefault();
		});
	}
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFuYWx5dGljcy5qcyIsImZvcm1zLmpzIiwibmF2aWdhdGlvbi5qcyJdLCJuYW1lcyI6WyIkIiwibXBfYW5hbHl0aWNzX3RyYWNraW5nX2V2ZW50IiwidHlwZSIsImNhdGVnb3J5IiwiYWN0aW9uIiwibGFiZWwiLCJ2YWx1ZSIsImdhIiwidHJhY2tTaGFyZSIsInRleHQiLCJwb3NpdGlvbiIsImhhc0NsYXNzIiwibG9jYXRpb24iLCJwYXRobmFtZSIsImNsaWNrIiwiZSIsInRyaW0iLCJocmVmIiwid2lkZ2V0X3RpdGxlIiwiY2xvc2VzdCIsImZpbmQiLCJzaWRlYmFyX3NlY3Rpb25fdGl0bGUiLCJkb2N1bWVudCIsInJlYWR5IiwiUFVNIiwiY3VycmVudF9wb3B1cCIsImdldFBvcHVwIiwic2V0dGluZ3MiLCJnZXRTZXR0aW5ncyIsInBvcHVwX2lkIiwiaWQiLCJvbiIsImNsb3NlX3RyaWdnZXIiLCJmbiIsInBvcG1ha2UiLCJsYXN0X2Nsb3NlX3RyaWdnZXIiLCJ1cmwiLCJhdHRyIiwibWlubnBvc3RfbWVtYmVyc2hpcF9kYXRhIiwidXJsX2FjY2Vzc19sZXZlbCIsImN1cnJlbnRfdXNlciIsImNhbl9hY2Nlc3MiLCJqUXVlcnkiLCJsZW5ndGgiLCJiZWZvcmUiLCJzdWJtaXQiLCJldmVudCIsInRoYXQiLCJwcmV2ZW50RGVmYXVsdCIsImJ1dHRvbiIsInByb3AiLCJhamF4X2Zvcm1fZGF0YSIsInNlcmlhbGl6ZSIsImFqYXgiLCJwYXJhbXMiLCJhamF4dXJsIiwiZGF0YVR5cGUiLCJkYXRhIiwiZG9uZSIsInJlc3BvbnNlIiwibWVzc2FnZSIsInN1Y2Nlc3MiLCJoaWRlIiwiYW5hbHl0aWNzX2FjdGlvbiIsInVzZXJfc3RhdHVzIiwiaHRtbCIsImZhaWwiLCJhbHdheXMiLCJ0YXJnZXQiLCJyZXNldCIsImNvbnRhaW5lciIsIm1lbnUiLCJsaW5rcyIsImkiLCJsZW4iLCJnZXRFbGVtZW50QnlJZCIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwic3R5bGUiLCJkaXNwbGF5Iiwic2V0QXR0cmlidXRlIiwiY2xhc3NOYW1lIiwiaW5kZXhPZiIsIm9uY2xpY2siLCJyZXBsYWNlIiwiYWRkRXZlbnRMaXN0ZW5lciIsInRvZ2dsZUZvY3VzIiwic2VsZiIsInRhZ05hbWUiLCJ0b0xvd2VyQ2FzZSIsInBhcmVudEVsZW1lbnQiLCJ0b3VjaFN0YXJ0Rm4iLCJwYXJlbnRMaW5rIiwicXVlcnlTZWxlY3RvckFsbCIsIndpbmRvdyIsIm1lbnVJdGVtIiwicGFyZW50Tm9kZSIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwiY2hpbGRyZW4iLCJyZW1vdmUiLCJhZGQiLCJ0b2dnbGVDbGFzcyJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxDQUFFLFVBQVVBLENBQVYsRUFBYzs7QUFFZixVQUFTQywyQkFBVCxDQUFzQ0MsSUFBdEMsRUFBNENDLFFBQTVDLEVBQXNEQyxNQUF0RCxFQUE4REMsS0FBOUQsRUFBcUVDLEtBQXJFLEVBQTZFO0FBQzVFLE1BQUssT0FBT0MsRUFBUCxLQUFjLFdBQW5CLEVBQWlDO0FBQ2hDLE9BQUssT0FBT0QsS0FBUCxLQUFpQixXQUF0QixFQUFvQztBQUNuQ0MsT0FBSSxNQUFKLEVBQVlMLElBQVosRUFBa0JDLFFBQWxCLEVBQTRCQyxNQUE1QixFQUFvQ0MsS0FBcEM7QUFDQSxJQUZELE1BRU87QUFDTkUsT0FBSSxNQUFKLEVBQVlMLElBQVosRUFBa0JDLFFBQWxCLEVBQTRCQyxNQUE1QixFQUFvQ0MsS0FBcEMsRUFBMkNDLEtBQTNDO0FBQ0E7QUFDRCxHQU5ELE1BTU87QUFDTjtBQUNBO0FBQ0Q7O0FBRUQsVUFBU0UsVUFBVCxDQUFxQkMsSUFBckIsRUFBMkJDLFFBQTNCLEVBQXNDOztBQUVyQztBQUNBLE1BQUssQ0FBRVYsRUFBRyxPQUFILEVBQVlXLFFBQVosQ0FBc0IsV0FBdEIsQ0FBRixJQUF3QyxZQUFZRixJQUF6RCxFQUFnRTtBQUMvRDtBQUNBOztBQUVEO0FBQ0FSLDhCQUE2QixPQUE3QixFQUFzQyxhQUFhUyxRQUFuRCxFQUE2REQsSUFBN0QsRUFB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QyxDQUF1QyxPQUF2QyxFQUFnRCxVQUFTZSxLQUFULEVBQWdCO0FBQy9EOUMsS0FBRSx5QkFBRixFQUE2QnFHLFdBQTdCLENBQTBDLFNBQTFDO0FBQ0F2RCxTQUFNRSxjQUFOO0FBQ0EsR0FIRDtBQUlBO0FBRUQsQ0FURCIsImZpbGUiOiJtaW5ucG9zdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIiggZnVuY3Rpb24oICQgKSB7XG5cblx0ZnVuY3Rpb24gbXBfYW5hbHl0aWNzX3RyYWNraW5nX2V2ZW50KCB0eXBlLCBjYXRlZ29yeSwgYWN0aW9uLCBsYWJlbCwgdmFsdWUgKSB7XG5cdFx0aWYgKCB0eXBlb2YgZ2EgIT09ICd1bmRlZmluZWQnICkge1xuXHRcdFx0aWYgKCB0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnICkge1xuXHRcdFx0XHRnYSggJ3NlbmQnLCB0eXBlLCBjYXRlZ29yeSwgYWN0aW9uLCBsYWJlbCApO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z2EoICdzZW5kJywgdHlwZSwgY2F0ZWdvcnksIGFjdGlvbiwgbGFiZWwsIHZhbHVlICk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdH1cblxuXHRmdW5jdGlvbiB0cmFja1NoYXJlKCB0ZXh0LCBwb3NpdGlvbiApIHtcblxuXHRcdC8vIGlmIGEgbm90IGxvZ2dlZCBpbiB1c2VyIHRyaWVzIHRvIGVtYWlsLCBkb24ndCBjb3VudCB0aGF0IGFzIGEgc2hhcmVcblx0XHRpZiAoICEgJCggJ2JvZHkgJykuaGFzQ2xhc3MoICdsb2dnZWQtaW4nKSAmJiAnRW1haWwnID09PSB0ZXh0ICkge1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdC8vIHRyYWNrIGFzIGFuIGV2ZW50LCBhbmQgYXMgc29jaWFsIGlmIGl0IGlzIHR3aXR0ZXIgb3IgZmJcblx0XHRtcF9hbmFseXRpY3NfdHJhY2tpbmdfZXZlbnQoICdldmVudCcsICdTaGFyZSAtICcgKyBwb3NpdGlvbiwgdGV4dCwgbG9jYXRpb24ucGF0aG5hbWUgKTtcblx0XHRpZiAoICd1bmRlZmluZWQnICE9PSB0eXBlb2YgZ2EgKSB7XG5cdFx0XHRpZiAoICdGYWNlYm9vaycgPT09IHRleHQgfHwgJ1R3aXR0ZXInID09PSB0ZXh0ICkge1xuXHRcdFx0XHRpZiAoIHRleHQgPT0gJ0ZhY2Vib29rJyApIHtcblx0XHRcdFx0XHRnYSggJ3NlbmQnLCAnc29jaWFsJywgdGV4dCwgJ1NoYXJlJywgbG9jYXRpb24ucGF0aG5hbWUgKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRnYSggJ3NlbmQnLCAnc29jaWFsJywgdGV4dCwgJ1R3ZWV0JywgbG9jYXRpb24ucGF0aG5hbWUgKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHR9XG5cblx0JCAoICcubS1lbnRyeS1zaGFyZS10b3AgYScgKS5jbGljayggZnVuY3Rpb24oIGUgKSB7XG5cdFx0dmFyIHRleHQgPSAkKCB0aGlzICkudGV4dCgpLnRyaW0oKTtcblx0XHR2YXIgcG9zaXRpb24gPSAndG9wJztcblx0XHR0cmFja1NoYXJlKCB0ZXh0LCBwb3NpdGlvbiApO1xuXHR9KTtcblxuXHQkICggJy5tLWVudHJ5LXNoYXJlLWJvdHRvbSBhJyApLmNsaWNrKCBmdW5jdGlvbiggZSApIHtcblx0XHR2YXIgdGV4dCA9ICQoIHRoaXMgKS50ZXh0KCkudHJpbSgpO1xuXHRcdHZhciBwb3NpdGlvbiA9ICdib3R0b20nO1xuXHRcdHRyYWNrU2hhcmUoIHRleHQsIHBvc2l0aW9uICk7XG5cdH0pO1xuXG5cdCQoICcjbmF2aWdhdGlvbi1mZWF0dXJlZCBhJyApLmNsaWNrKCBmdW5jdGlvbiggZSApIHtcblx0XHRtcF9hbmFseXRpY3NfdHJhY2tpbmdfZXZlbnQoICdldmVudCcsICdGZWF0dXJlZCBCYXIgTGluaycsICdDbGljaycsIHRoaXMuaHJlZiApO1xuXHR9KTtcblx0JCggJ2EuZ2xlYW4tc2lkZWJhcicgKS5jbGljayggZnVuY3Rpb24oIGUgKSB7XG5cdFx0bXBfYW5hbHl0aWNzX3RyYWNraW5nX2V2ZW50KCAnZXZlbnQnLCAnU2lkZWJhciBTdXBwb3J0IExpbmsnLCAnQ2xpY2snLCB0aGlzLmhyZWYgKTtcblx0fSk7XG5cblx0JCggJ2EnLCAkKCAnLm8tc2l0ZS1zaWRlYmFyJyApICkuY2xpY2soIGZ1bmN0aW9uKCBlICkge1xuXHRcdHZhciB3aWRnZXRfdGl0bGUgPSAkKHRoaXMpLmNsb3Nlc3QoJy5tLXdpZGdldCcpLmZpbmQoJ2gzJykudGV4dCgpO1xuXHRcdHZhciBzaWRlYmFyX3NlY3Rpb25fdGl0bGUgPSAnJztcblx0XHRpZiAod2lkZ2V0X3RpdGxlID09PSAnJykge1xuXHRcdFx0Ly9zaWRlYmFyX3NlY3Rpb25fdGl0bGUgPSAkKHRoaXMpLmNsb3Nlc3QoJy5ub2RlLXR5cGUtc3BpbGwnKS5maW5kKCcubm9kZS10aXRsZSBhJykudGV4dCgpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRzaWRlYmFyX3NlY3Rpb25fdGl0bGUgPSB3aWRnZXRfdGl0bGU7XG5cdFx0fVxuXHRcdG1wX2FuYWx5dGljc190cmFja2luZ19ldmVudCgnZXZlbnQnLCAnU2lkZWJhciBMaW5rJywgJ0NsaWNrJywgc2lkZWJhcl9zZWN0aW9uX3RpdGxlKTtcblx0fSk7XG5cblx0JCggZG9jdW1lbnQgKS5yZWFkeSggZnVuY3Rpb24gKCBlICkge1xuXG5cdFx0aWYgKCAndW5kZWZpbmVkJyAhPT0gdHlwZW9mIFBVTSApIHtcblx0XHRcdHZhciBjdXJyZW50X3BvcHVwID0gUFVNLmdldFBvcHVwKCAkKCAnLnB1bScgKSApO1xuXHRcdFx0dmFyIHNldHRpbmdzID0gUFVNLmdldFNldHRpbmdzKCAkKCAnLnB1bScgKSApO1xuXHRcdFx0dmFyIHBvcHVwX2lkID0gc2V0dGluZ3MuaWQ7XG5cdFx0XHQkKCBkb2N1bWVudCApLm9uKCdwdW1BZnRlck9wZW4nLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdG1wX2FuYWx5dGljc190cmFja2luZ19ldmVudCggJ2V2ZW50JywgJ1BvcHVwJywgJ1Nob3cnLCBwb3B1cF9pZCwgeyAnbm9uSW50ZXJhY3Rpb24nOiAxIH0gKTtcblx0XHRcdH0pO1xuXHRcdFx0JCggZG9jdW1lbnQgKS5vbigncHVtQWZ0ZXJDbG9zZScsIGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0dmFyIGNsb3NlX3RyaWdnZXIgPSAkLmZuLnBvcG1ha2UubGFzdF9jbG9zZV90cmlnZ2VyO1xuXHRcdFx0XHRpZiAoICd1bmRlZmluZWQnICE9PSB0eXBlb2YgY2xvc2VfdHJpZ2dlciApIHtcblx0XHRcdFx0XHRtcF9hbmFseXRpY3NfdHJhY2tpbmdfZXZlbnQoICdldmVudCcsICdQb3B1cCcsIGNsb3NlX3RyaWdnZXIsIHBvcHVwX2lkLCB7ICdub25JbnRlcmFjdGlvbic6IDEgfSApO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdCQoICcubWVzc2FnZS1jbG9zZScgKS5jbGljayhmdW5jdGlvbiggZSApIHsgLy8gdXNlciBjbGlja3MgbGluayB3aXRoIGNsb3NlIGNsYXNzXG5cdFx0XHRcdHZhciBjbG9zZV90cmlnZ2VyID0gJ0Nsb3NlIEJ1dHRvbic7XG5cdFx0XHRcdG1wX2FuYWx5dGljc190cmFja2luZ19ldmVudCggJ2V2ZW50JywgJ1BvcHVwJywgY2xvc2VfdHJpZ2dlciwgcG9wdXBfaWQsIHsgJ25vbkludGVyYWN0aW9uJzogMSB9ICk7XG5cdFx0XHR9KTtcblx0XHRcdCQoICcubWVzc2FnZS1sb2dpbicgKS5jbGljayhmdW5jdGlvbiggZSApIHsgLy8gdXNlciBjbGlja3MgbGluayB3aXRoIGxvZ2luIGNsYXNzXG5cdFx0XHRcdHZhciB1cmwgPSAkKHRoaXMpLmF0dHIoJ2hyZWYnKTtcblx0XHRcdFx0bXBfYW5hbHl0aWNzX3RyYWNraW5nX2V2ZW50KCAnZXZlbnQnLCAnUG9wdXAnLCAnTG9naW4gTGluaycsIHVybCApO1xuXHRcdFx0fSk7XG5cdFx0XHQkKCAnLnB1bS1jb250ZW50IGE6bm90KCAubWVzc2FnZS1jbG9zZSwgLnB1bS1jbG9zZSwgLm1lc3NhZ2UtbG9naW4gKScgKS5jbGljayggZnVuY3Rpb24oIGUgKSB7IC8vIHVzZXIgY2xpY2tzIHNvbWV0aGluZyB0aGF0IGlzIG5vdCBjbG9zZSB0ZXh0IG9yIGNsb3NlIGljb25cblx0XHRcdFx0bXBfYW5hbHl0aWNzX3RyYWNraW5nX2V2ZW50KCAnZXZlbnQnLCAnUG9wdXAnLCAnQ2xpY2snLCBwb3B1cF9pZCApO1xuICAgICAgICAgICAgfSk7XG5cdFx0fVxuXG5cdFx0aWYgKCAndW5kZWZpbmVkJyAhPT0gdHlwZW9mIG1pbm5wb3N0X21lbWJlcnNoaXBfZGF0YSAmJiAnJyAhPT0gbWlubnBvc3RfbWVtYmVyc2hpcF9kYXRhLnVybF9hY2Nlc3NfbGV2ZWwgKSB7XG5cdFx0XHR2YXIgdHlwZSA9ICdldmVudCc7XG5cdFx0XHR2YXIgY2F0ZWdvcnkgPSAnTWVtYmVyIENvbnRlbnQnO1xuXHRcdFx0dmFyIGxhYmVsID0gbG9jYXRpb24ucGF0aG5hbWU7IC8vIGkgdGhpbmsgd2UgY291bGQgcG9zc2libHkgcHV0IHNvbWUgZ3JvdXBpbmcgaGVyZSwgYnV0IHdlIGRvbid0IG5lY2Vzc2FyaWx5IGhhdmUgYWNjZXNzIHRvIG9uZSBhbmQgbWF5YmUgaXQncyBub3Qgd29ydGh3aGlsZSB5ZXRcblx0XHRcdHZhciBhY3Rpb24gPSAnQmxvY2tlZCc7XG5cdFx0XHRpZiAoIHRydWUgPT09IG1pbm5wb3N0X21lbWJlcnNoaXBfZGF0YS5jdXJyZW50X3VzZXIuY2FuX2FjY2VzcyApIHtcblx0XHRcdFx0YWN0aW9uID0gJ1Nob3duJztcblx0XHRcdH1cblx0XHRcdG1wX2FuYWx5dGljc190cmFja2luZ19ldmVudCggdHlwZSwgY2F0ZWdvcnksIGFjdGlvbiwgbGFiZWwgKTtcblx0XHR9XG5cdH0pO1xuXG59ICkoIGpRdWVyeSApOyIsImpRdWVyeSggZG9jdW1lbnQgKS5yZWFkeSggZnVuY3Rpb24oICQgKSB7XG5cdFwidXNlIHN0cmljdFwiO1xuXHRpZiAoICQoJy5tLWZvcm0tbmV3c2xldHRlci1zaG9ydGNvZGUnKS5sZW5ndGggPiAwICkge1xuXHRcdCQoJy5tLWZvcm0tbmV3c2xldHRlci1zaG9ydGNvZGUgZmllbGRzZXQnKS5iZWZvcmUoJzxkaXYgY2xhc3M9XCJtLWhvbGQtbWVzc2FnZVwiPjwvZGl2PicpO1xuXHRcdCQoJy5tLWZvcm0tbmV3c2xldHRlci1zaG9ydGNvZGUgZm9ybScpLnN1Ym1pdChmdW5jdGlvbihldmVudCkge1xuXHRcdFx0dmFyIHRoYXQgPSB0aGlzO1xuXHRcdFx0ZXZlbnQucHJldmVudERlZmF1bHQoKTsgLy8gUHJldmVudCB0aGUgZGVmYXVsdCBmb3JtIHN1Ym1pdC5cblx0XHRcdHZhciBidXR0b24gPSAkKCdidXR0b24nLCB0aGlzKTtcblx0XHRcdGJ1dHRvbi5wcm9wKCdkaXNhYmxlZCcsIHRydWUpO1xuXHRcdFx0YnV0dG9uLnRleHQoJ1Byb2Nlc3NpbmcnKTtcblx0XHRcdC8vIHNlcmlhbGl6ZSB0aGUgZm9ybSBkYXRhXG5cdFx0XHR2YXIgYWpheF9mb3JtX2RhdGEgPSAkKHRoaXMpLnNlcmlhbGl6ZSgpO1xuXHRcdFx0Ly9hZGQgb3VyIG93biBhamF4IGNoZWNrIGFzIFgtUmVxdWVzdGVkLVdpdGggaXMgbm90IGFsd2F5cyByZWxpYWJsZVxuXHRcdFx0YWpheF9mb3JtX2RhdGEgPSBhamF4X2Zvcm1fZGF0YSArICcmYWpheHJlcXVlc3Q9dHJ1ZSZzdWJzY3JpYmUnO1xuXHRcdFx0JC5hamF4KHtcblx0XHRcdFx0dXJsOiBwYXJhbXMuYWpheHVybCwgLy8gZG9tYWluL3dwLWFkbWluL2FkbWluLWFqYXgucGhwXG5cdFx0XHRcdHR5cGU6ICdwb3N0Jyxcblx0XHRcdFx0ZGF0YVR5cGUgOiAnanNvbicsXG5cdFx0XHRcdGRhdGE6IGFqYXhfZm9ybV9kYXRhXG5cdFx0XHR9KVxuXHRcdFx0LmRvbmUoZnVuY3Rpb24ocmVzcG9uc2UpIHsgLy8gcmVzcG9uc2UgZnJvbSB0aGUgUEhQIGFjdGlvblxuXHRcdFx0XHR2YXIgbWVzc2FnZSA9ICcnO1xuXHRcdFx0XHRpZiAoIHJlc3BvbnNlLnN1Y2Nlc3MgPT09IHRydWUgKSB7XG5cdFx0XHRcdFx0JCgnZmllbGRzZXQnLCB0aGF0KS5oaWRlKCk7XG5cdFx0XHRcdFx0YnV0dG9uLnRleHQoJ1RoYW5rcycpO1xuXHRcdFx0XHRcdHZhciBhbmFseXRpY3NfYWN0aW9uID0gJ1NpZ251cCc7XG5cdFx0XHRcdFx0c3dpdGNoIChyZXNwb25zZS5kYXRhLnVzZXJfc3RhdHVzKSB7XG5cdFx0XHRcdFx0XHRjYXNlICdleGlzdGluZyc6XG5cdFx0XHRcdFx0XHRcdGFuYWx5dGljc19hY3Rpb24gPSAnVXBkYXRlJztcblx0XHRcdFx0XHRcdFx0bWVzc2FnZSA9ICdUaGFua3MgZm9yIHVwZGF0aW5nIHlvdXIgZW1haWwgcHJlZmVyZW5jZXMuIFRoZXkgd2lsbCBnbyBpbnRvIGVmZmVjdCBpbW1lZGlhdGVseS4nO1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdGNhc2UgJ25ldyc6XG5cdFx0XHRcdFx0XHRcdGFuYWx5dGljc19hY3Rpb24gPSAnU2lnbnVwJztcblx0XHRcdFx0XHRcdFx0bWVzc2FnZSA9ICdXZSBoYXZlIGFkZGVkIHlvdSB0byB0aGUgTWlublBvc3QgbWFpbGluZyBsaXN0Lic7XG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0Y2FzZSAncGVuZGluZyc6XG5cdFx0XHRcdFx0XHRcdGFuYWx5dGljc19hY3Rpb24gPSAnU2lnbnVwJztcblx0XHRcdFx0XHRcdFx0bWVzc2FnZSA9ICdXZSBoYXZlIGFkZGVkIHlvdSB0byB0aGUgTWlublBvc3QgbWFpbGluZyBsaXN0LiBZb3Ugd2lsbCBuZWVkIHRvIGNsaWNrIHRoZSBjb25maXJtYXRpb24gbGluayBpbiB0aGUgZW1haWwgd2Ugc2VudCB0byBiZWdpbiByZWNlaXZpbmcgbWVzc2FnZXMuJztcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICggJ2Z1bmN0aW9uJyA9PT0gdHlwZW9mIG1wX2FuYWx5dGljc190cmFja2luZ19ldmVudCApIHtcblx0XHRcdFx0XHRcdG1wX2FuYWx5dGljc190cmFja2luZ19ldmVudCggJ2V2ZW50JywgJ05ld3NsZXR0ZXInLCBhbmFseXRpY3NfYWN0aW9uLCBsb2NhdGlvbi5wYXRobmFtZSApO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRidXR0b24ucHJvcCgnZGlzYWJsZWQnLCBmYWxzZSk7XG5cdFx0XHRcdFx0YnV0dG9uLnRleHQoJ1N1YnNjcmliZScpO1xuXHRcdFx0XHRcdGlmICggJ2Z1bmN0aW9uJyA9PT0gdHlwZW9mIG1wX2FuYWx5dGljc190cmFja2luZ19ldmVudCApIHtcblx0XHRcdFx0XHRcdG1wX2FuYWx5dGljc190cmFja2luZ19ldmVudCggJ2V2ZW50JywgJ05ld3NsZXR0ZXInLCAnRmFpbCcsIGxvY2F0aW9uLnBhdGhuYW1lICk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRcdCQoJy5tLWhvbGQtbWVzc2FnZScpLmh0bWwoJzxkaXYgY2xhc3M9XCJtLWZvcm0tbWVzc2FnZSBtLWZvcm0tbWVzc2FnZS1pbmZvXCI+JyArIG1lc3NhZ2UgKyAnPC9kaXY+Jyk7XG5cdFx0XHR9KVxuXHRcdFx0LmZhaWwoZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdFx0JCgnLm0taG9sZC1tZXNzYWdlJykuaHRtbCgnPGRpdiBjbGFzcz1cIm0tZm9ybS1tZXNzYWdlIG0tZm9ybS1tZXNzYWdlLWluZm9cIj5BbiBlcnJvciBoYXMgb2NjdXJlZC4gUGxlYXNlIHRyeSBhZ2Fpbi48L2Rpdj4nKTtcblx0XHRcdFx0YnV0dG9uLnByb3AoJ2Rpc2FibGVkJywgZmFsc2UpO1xuXHRcdFx0XHRidXR0b24udGV4dCgnU3Vic2NyaWJlJyk7XG5cdFx0XHRcdGlmICggJ2Z1bmN0aW9uJyA9PT0gdHlwZW9mIG1wX2FuYWx5dGljc190cmFja2luZ19ldmVudCApIHtcblx0XHRcdFx0XHRtcF9hbmFseXRpY3NfdHJhY2tpbmdfZXZlbnQoICdldmVudCcsICdOZXdzbGV0dGVyJywgJ0ZhaWwnLCBsb2NhdGlvbi5wYXRobmFtZSApO1xuXHRcdFx0XHR9XG5cdFx0XHR9KVxuXHRcdFx0LmFsd2F5cyhmdW5jdGlvbigpIHtcblx0XHRcdFx0ZXZlbnQudGFyZ2V0LnJlc2V0KCk7XG5cdFx0XHR9KTtcblx0XHR9KTtcblx0fVxufSk7IiwiLyoqXG4gKiBGaWxlIG5hdmlnYXRpb24uanMuXG4gKlxuICogSGFuZGxlcyB0b2dnbGluZyB0aGUgbmF2aWdhdGlvbiBtZW51IGZvciBzbWFsbCBzY3JlZW5zIGFuZCBlbmFibGVzIFRBQiBrZXlcbiAqIG5hdmlnYXRpb24gc3VwcG9ydCBmb3IgZHJvcGRvd24gbWVudXMuXG4gKi9cbiggZnVuY3Rpb24oKSB7XG5cdHZhciBjb250YWluZXIsIGJ1dHRvbiwgbWVudSwgbGlua3MsIGksIGxlbjtcblxuXHRjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggJ25hdmlnYXRpb24tcHJpbWFyeScgKTtcblx0aWYgKCAhIGNvbnRhaW5lciApIHtcblx0XHRyZXR1cm47XG5cdH1cblxuXHRidXR0b24gPSBjb250YWluZXIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoICdidXR0b24nIClbMF07XG5cdGlmICggJ3VuZGVmaW5lZCcgPT09IHR5cGVvZiBidXR0b24gKSB7XG5cdFx0cmV0dXJuO1xuXHR9XG5cblx0bWVudSA9IGNvbnRhaW5lci5nZXRFbGVtZW50c0J5VGFnTmFtZSggJ3VsJyApWzBdO1xuXG5cdC8vIEhpZGUgbWVudSB0b2dnbGUgYnV0dG9uIGlmIG1lbnUgaXMgZW1wdHkgYW5kIHJldHVybiBlYXJseS5cblx0aWYgKCAndW5kZWZpbmVkJyA9PT0gdHlwZW9mIG1lbnUgKSB7XG5cdFx0YnV0dG9uLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG5cdFx0cmV0dXJuO1xuXHR9XG5cblx0bWVudS5zZXRBdHRyaWJ1dGUoICdhcmlhLWV4cGFuZGVkJywgJ2ZhbHNlJyApO1xuXHRpZiAoIC0xID09PSBtZW51LmNsYXNzTmFtZS5pbmRleE9mKCAnbWVudScgKSApIHtcblx0XHRtZW51LmNsYXNzTmFtZSArPSAnIG1lbnUnO1xuXHR9XG5cblx0YnV0dG9uLm9uY2xpY2sgPSBmdW5jdGlvbigpIHtcblx0XHRpZiAoIC0xICE9PSBjb250YWluZXIuY2xhc3NOYW1lLmluZGV4T2YoICd0b2dnbGVkJyApICkge1xuXHRcdFx0Y29udGFpbmVyLmNsYXNzTmFtZSA9IGNvbnRhaW5lci5jbGFzc05hbWUucmVwbGFjZSggJyB0b2dnbGVkJywgJycgKTtcblx0XHRcdGJ1dHRvbi5zZXRBdHRyaWJ1dGUoICdhcmlhLWV4cGFuZGVkJywgJ2ZhbHNlJyApO1xuXHRcdFx0bWVudS5zZXRBdHRyaWJ1dGUoICdhcmlhLWV4cGFuZGVkJywgJ2ZhbHNlJyApO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjb250YWluZXIuY2xhc3NOYW1lICs9ICcgdG9nZ2xlZCc7XG5cdFx0XHRidXR0b24uc2V0QXR0cmlidXRlKCAnYXJpYS1leHBhbmRlZCcsICd0cnVlJyApO1xuXHRcdFx0bWVudS5zZXRBdHRyaWJ1dGUoICdhcmlhLWV4cGFuZGVkJywgJ3RydWUnICk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vIEdldCBhbGwgdGhlIGxpbmsgZWxlbWVudHMgd2l0aGluIHRoZSBtZW51LlxuXHRsaW5rcyAgICA9IG1lbnUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoICdhJyApO1xuXG5cdC8vIEVhY2ggdGltZSBhIG1lbnUgbGluayBpcyBmb2N1c2VkIG9yIGJsdXJyZWQsIHRvZ2dsZSBmb2N1cy5cblx0Zm9yICggaSA9IDAsIGxlbiA9IGxpbmtzLmxlbmd0aDsgaSA8IGxlbjsgaSsrICkge1xuXHRcdGxpbmtzW2ldLmFkZEV2ZW50TGlzdGVuZXIoICdmb2N1cycsIHRvZ2dsZUZvY3VzLCB0cnVlICk7XG5cdFx0bGlua3NbaV0uYWRkRXZlbnRMaXN0ZW5lciggJ2JsdXInLCB0b2dnbGVGb2N1cywgdHJ1ZSApO1xuXHR9XG5cblx0LyoqXG5cdCAqIFNldHMgb3IgcmVtb3ZlcyAuZm9jdXMgY2xhc3Mgb24gYW4gZWxlbWVudC5cblx0ICovXG5cdGZ1bmN0aW9uIHRvZ2dsZUZvY3VzKCkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdC8vIE1vdmUgdXAgdGhyb3VnaCB0aGUgYW5jZXN0b3JzIG9mIHRoZSBjdXJyZW50IGxpbmsgdW50aWwgd2UgaGl0IC5uYXYtbWVudS5cblx0XHR3aGlsZSAoIC0xID09PSBzZWxmLmNsYXNzTmFtZS5pbmRleE9mKCAnbWVudScgKSApIHtcblxuXHRcdFx0Ly8gT24gbGkgZWxlbWVudHMgdG9nZ2xlIHRoZSBjbGFzcyAuZm9jdXMuXG5cdFx0XHRpZiAoICdsaScgPT09IHNlbGYudGFnTmFtZS50b0xvd2VyQ2FzZSgpICkge1xuXHRcdFx0XHRpZiAoIC0xICE9PSBzZWxmLmNsYXNzTmFtZS5pbmRleE9mKCAnZm9jdXMnICkgKSB7XG5cdFx0XHRcdFx0c2VsZi5jbGFzc05hbWUgPSBzZWxmLmNsYXNzTmFtZS5yZXBsYWNlKCAnIGZvY3VzJywgJycgKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRzZWxmLmNsYXNzTmFtZSArPSAnIGZvY3VzJztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRzZWxmID0gc2VsZi5wYXJlbnRFbGVtZW50O1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBUb2dnbGVzIGBmb2N1c2AgY2xhc3MgdG8gYWxsb3cgc3VibWVudSBhY2Nlc3Mgb24gdGFibGV0cy5cblx0ICovXG5cdCggZnVuY3Rpb24oIGNvbnRhaW5lciApIHtcblx0XHR2YXIgdG91Y2hTdGFydEZuLCBpLFxuXHRcdFx0cGFyZW50TGluayA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCAnLm1lbnUtaXRlbS1oYXMtY2hpbGRyZW4gPiBhLCAucGFnZV9pdGVtX2hhc19jaGlsZHJlbiA+IGEnICk7XG5cblx0XHRpZiAoICdvbnRvdWNoc3RhcnQnIGluIHdpbmRvdyApIHtcblx0XHRcdHRvdWNoU3RhcnRGbiA9IGZ1bmN0aW9uKCBlICkge1xuXHRcdFx0XHR2YXIgbWVudUl0ZW0gPSB0aGlzLnBhcmVudE5vZGUsIGk7XG5cblx0XHRcdFx0aWYgKCAhIG1lbnVJdGVtLmNsYXNzTGlzdC5jb250YWlucyggJ2ZvY3VzJyApICkge1xuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRmb3IgKCBpID0gMDsgaSA8IG1lbnVJdGVtLnBhcmVudE5vZGUuY2hpbGRyZW4ubGVuZ3RoOyArK2kgKSB7XG5cdFx0XHRcdFx0XHRpZiAoIG1lbnVJdGVtID09PSBtZW51SXRlbS5wYXJlbnROb2RlLmNoaWxkcmVuW2ldICkge1xuXHRcdFx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdG1lbnVJdGVtLnBhcmVudE5vZGUuY2hpbGRyZW5baV0uY2xhc3NMaXN0LnJlbW92ZSggJ2ZvY3VzJyApO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRtZW51SXRlbS5jbGFzc0xpc3QuYWRkKCAnZm9jdXMnICk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0bWVudUl0ZW0uY2xhc3NMaXN0LnJlbW92ZSggJ2ZvY3VzJyApO1xuXHRcdFx0XHR9XG5cdFx0XHR9O1xuXG5cdFx0XHRmb3IgKCBpID0gMDsgaSA8IHBhcmVudExpbmsubGVuZ3RoOyArK2kgKSB7XG5cdFx0XHRcdHBhcmVudExpbmtbaV0uYWRkRXZlbnRMaXN0ZW5lciggJ3RvdWNoc3RhcnQnLCB0b3VjaFN0YXJ0Rm4sIGZhbHNlICk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9KCBjb250YWluZXIgKSApO1xufSApKCk7XG5cbi8vIHVzZXIgYWNjb3VudCBuYXZpZ2F0aW9uIGNhbiBiZSBhIGRyb3Bkb3duXG5qUXVlcnkoIGRvY3VtZW50ICkucmVhZHkoIGZ1bmN0aW9uKCAkICkge1xuXHQvLyBoaWRlIG1lbnVcblx0aWYgKCQoJyN1c2VyLWFjY291bnQtYWNjZXNzIHVsJykubGVuZ3RoID4gMCApIHtcblx0XHQkKCcjdXNlci1hY2NvdW50LWFjY2VzcyA+IGxpID4gYScpLm9uKCAnY2xpY2snLCBmdW5jdGlvbihldmVudCkge1xuXHRcdFx0JCgnI3VzZXItYWNjb3VudC1hY2Nlc3MgdWwnKS50b2dnbGVDbGFzcyggJ3Zpc2libGUnICk7XG5cdFx0XHRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdH0pO1xuXHR9XG5cbn0pO1xuIl19
